<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Traveling Salesman | IT426</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<style>
:root{--bg:#0f1117;--surface:#1a1d27;--surface2:#22263a;--border:#2e3352;--accent:#34d399;--accent2:#6c63ff;--success:#10b981;--danger:#ef4444;--warn:#f59e0b;--text:#e8eaf6;--text-dim:#8b90b8;--text-muted:#4a5080;}
*{margin:0;padding:0;box-sizing:border-box;}button{color:inherit;font-family:inherit;}
body{background:var(--bg);color:var(--text);font-family:'Space Grotesk',sans-serif;min-height:100vh;overflow-x:hidden;}
nav{background:var(--surface);border-bottom:1px solid var(--border);padding:13px 20px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;}
nav a{color:var(--accent);text-decoration:none;font-size:14px;font-weight:500;}nav a:hover{opacity:.7;}
.nav-badge{background:var(--surface2);border:1px solid var(--border);padding:4px 12px;border-radius:20px;font-size:12px;color:var(--text-muted);}
.hero{text-align:center;padding:32px 24px 24px;background:radial-gradient(ellipse 80% 60% at 50% 0%,rgba(52,211,153,.1) 0%,transparent 70%);}
.hero-tag{display:inline-block;background:rgba(52,211,153,.1);border:1px solid rgba(52,211,153,.4);color:var(--accent);padding:4px 14px;border-radius:20px;font-size:12px;font-weight:600;letter-spacing:.05em;text-transform:uppercase;margin-bottom:16px;}
.hero h1{font-size:clamp(24px,4vw,44px);font-weight:700;background:linear-gradient(135deg,#fff 40%,var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:10px;}
.hero p{color:var(--text-dim);font-size:15px;max-width:520px;margin:0 auto;}
.steps-bar{display:flex;align-items:center;justify-content:center;padding:24px 32px;max-width:800px;margin:0 auto;}
.step{display:flex;flex-direction:column;align-items:center;gap:6px;flex:1;}
.sc{width:38px;height:38px;border-radius:50%;border:2px solid var(--border);background:var(--surface);display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;color:var(--text-muted);transition:all .4s;z-index:2;position:relative;}
.sc.active{border-color:var(--accent);background:var(--accent);color:#000;box-shadow:0 0 16px rgba(52,211,153,.4);}
.sc.done{border-color:var(--success);background:var(--success);color:#fff;}
.sl{font-size:11px;color:var(--text-muted);font-weight:600;text-align:center;white-space:nowrap;transition:color .4s;}
.sl.active{color:var(--accent);}.sl.done{color:var(--success);}
.sline{flex:1;height:2px;background:var(--border);margin-top:-20px;margin-bottom:20px;z-index:1;transition:background .4s;}
.sline.done{background:var(--success);}
.section{max-width:1000px;margin:0 auto;padding:0 24px 80px;display:none;}
.section.visible{display:block;animation:fadeUp .5s ease;}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px);}to{opacity:1;transform:translateY(0);}}
.sec-title{font-size:22px;font-weight:700;margin-bottom:6px;}
.sec-sub{color:var(--text-dim);font-size:14px;margin-bottom:24px;}
.card{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:24px;overflow:hidden;}
.card-sm{background:var(--surface2);border:1px solid var(--border);border-radius:12px;padding:14px;}
.code-block{background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:12px 14px;font-family:'JetBrains Mono',monospace;font-size:12px;color:#34d399;white-space:pre-wrap;word-break:break-word;line-height:1.7;overflow-x:auto;}
.code-comment{color:var(--text-muted);}
.state-label{font-size:11px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.08em;font-weight:700;margin-bottom:6px;}

/* TSP CANVAS */
#tsp-canvas{border-radius:12px;border:1px solid var(--border);display:block;cursor:pointer;background:var(--bg);}
.tsp-layout{display:grid;grid-template-columns:1fr 260px;gap:20px;align-items:start;}
@media(max-width:700px){.tsp-layout{grid-template-columns:1fr;}}

/* ROUTE */
.route-step{display:flex;align-items:center;gap:8px;padding:7px 10px;background:var(--surface2);border:1px solid var(--border);border-radius:8px;font-size:13px;margin-bottom:5px;animation:fadeUp .2s ease;}
.city-dot{width:14px;height:14px;border-radius:50%;flex-shrink:0;}
.route-dist{color:var(--text-muted);font-size:11px;margin-left:auto;font-family:'JetBrains Mono',monospace;}
.total-box{background:linear-gradient(135deg,rgba(52,211,153,.12),rgba(108,99,255,.08));border:1px solid rgba(52,211,153,.3);border-radius:10px;padding:14px 16px;text-align:center;margin-top:8px;}
.total-val{font-size:32px;font-weight:700;color:var(--accent);font-family:'JetBrains Mono',monospace;}
.total-lbl{font-size:11px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.05em;}
.best-badge{background:rgba(52,211,153,.15);border:1px solid rgba(52,211,153,.4);color:var(--accent);padding:4px 12px;border-radius:8px;font-size:12px;font-weight:700;display:inline-block;margin-top:6px;}

/* EXPLOSION TABLE */
.explosion-table{width:100%;border-collapse:collapse;font-size:13px;}
.explosion-table th{padding:10px 14px;background:var(--surface2);border:1px solid var(--border);color:var(--text-dim);font-weight:600;text-align:left;}
.explosion-table td{padding:10px 14px;border:1px solid var(--border);color:var(--text-dim);}
.explosion-table tr:nth-child(even) td{background:rgba(255,255,255,.02);}
.explosion-table td.highlight{color:var(--warn);font-weight:700;}
.explosion-table td.danger{color:var(--danger);font-weight:700;}

/* QUESTIONS */
.qbox{background:linear-gradient(135deg,rgba(52,211,153,.07),rgba(108,99,255,.04));border:1px solid rgba(52,211,153,.25);border-radius:16px;padding:22px;margin-bottom:18px;}
.qt{font-size:17px;font-weight:600;margin-bottom:16px;color:var(--text);}
.options{display:flex;flex-direction:column;gap:9px;}
.option{background:var(--surface);border:2px solid var(--border);border-radius:12px;padding:13px 16px;cursor:pointer;transition:all .2s;display:flex;align-items:flex-start;gap:10px;font-size:14px;font-weight:500;text-align:left;width:100%;color:var(--text);}
.option:hover{border-color:var(--accent);background:rgba(52,211,153,.07);}
.option.correct-ans{border-color:var(--success);background:rgba(16,185,129,.1);color:var(--success);}
.option.wrong-ans{border-color:var(--danger);background:rgba(239,68,68,.07);color:var(--danger);}
.ol{background:var(--surface2);border-radius:6px;width:24px;height:24px;min-width:24px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:var(--text-dim);font-family:'JetBrains Mono',monospace;}
.option.correct-ans .ol{background:var(--success);color:#fff;}
.option.wrong-ans .ol{background:var(--danger);color:#fff;}
.feedback{display:none;border-radius:10px;padding:14px 16px;margin-top:14px;font-size:14px;line-height:1.6;}
.feedback.show{display:block;animation:fadeUp .3s ease;}
.feedback.correct{background:rgba(16,185,129,.1);border:1px solid rgba(16,185,129,.3);color:#6ee7b7;}
.feedback.wrong{background:rgba(239,68,68,.07);border:1px solid rgba(239,68,68,.3);color:#fca5a5;}
.fb-t{font-weight:700;margin-bottom:6px;}
.expl{display:none;background:var(--surface2);border:1px solid var(--border);border-radius:14px;padding:18px;margin-top:16px;}
.expl.show{display:block;animation:fadeUp .4s ease;}
.expl h3{color:var(--accent);font-size:15px;margin-bottom:10px;}
.expl ul{list-style:none;display:flex;flex-direction:column;gap:7px;}
.expl li{display:flex;gap:8px;font-size:14px;color:var(--text-dim);}
.expl li::before{content:"‚Üí";color:var(--accent);font-weight:700;flex-shrink:0;}
.fcomp{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:18px;margin-bottom:14px;transition:border-color .3s;}
.fcomp.ok{border-color:var(--success);}.fcomp.bad{border-color:var(--danger);}
.ftitle{font-size:15px;font-weight:700;margin-bottom:5px;display:flex;align-items:center;gap:8px;color:var(--text);}
.fnum{background:var(--accent);color:#000;width:26px;height:26px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;}
.fdesc{font-size:13px;color:var(--text-dim);margin-bottom:12px;}
.gfb{display:none;margin-top:8px;padding:9px 12px;border-radius:8px;font-size:13px;font-weight:500;}
.gfb.show{display:block;}
.gfb.ok{background:rgba(16,185,129,.12);color:#6ee7b7;border:1px solid rgba(16,185,129,.3);}
.gfb.bad{background:rgba(239,68,68,.08);color:#fca5a5;border:1px solid rgba(239,68,68,.25);}
.score-card{text-align:center;padding:36px 20px;background:linear-gradient(135deg,rgba(52,211,153,.1),rgba(108,99,255,.08));border:1px solid rgba(52,211,153,.3);border-radius:20px;}
.score-big{font-size:68px;font-weight:700;font-family:'JetBrains Mono',monospace;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.score-lbl{color:var(--text-dim);font-size:15px;margin-bottom:24px;}
.sbd{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;max-width:600px;margin:0 auto 20px;}
.si{background:var(--surface2);border-radius:10px;padding:10px 6px;font-size:12px;color:var(--text-dim);border:1px solid var(--border);text-align:center;}
.si.ok{border-color:var(--success);color:var(--success);}.si.bad{border-color:var(--danger);color:var(--danger);}
.si-icon{font-size:18px;margin-bottom:3px;}
.comp-card{text-align:center;padding:50px 20px;background:linear-gradient(135deg,rgba(16,185,129,.1),rgba(52,211,153,.08));border:1px solid var(--success);border-radius:20px;}
.comp-card h2{font-size:30px;font-weight:700;margin-bottom:10px;}
.comp-card p{color:var(--text-dim);margin-bottom:24px;}
.badges{display:flex;justify-content:center;gap:10px;flex-wrap:wrap;margin-bottom:24px;}
.badge{background:var(--surface2);border:1px solid var(--border);padding:10px 14px;border-radius:10px;font-size:13px;color:var(--accent);font-weight:600;}
.btn{padding:10px 20px;border-radius:10px;border:none;font-size:14px;font-weight:600;cursor:pointer;transition:all .2s;display:inline-flex;align-items:center;gap:6px;}
.btn-p{background:var(--accent);color:#000;}.btn-p:hover{background:#2fbd88;transform:translateY(-1px);}
.btn-g{background:var(--surface2);color:var(--text-dim);border:1px solid var(--border);}.btn-g:hover{background:var(--border);color:var(--text);}
.btn-f{width:100%;justify-content:center;}
::-webkit-scrollbar{width:6px;}::-webkit-scrollbar-track{background:var(--surface);}::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px;}

  /* ‚îÄ‚îÄ RESPONSIVE FIXES ‚îÄ‚îÄ */
  @media(max-width:768px){
    nav{padding:12px 16px;}
    nav .nav-badge:last-child{display:none;}
    .hero{padding:36px 16px 24px;}
    .hero p{font-size:14px;}
    .steps-bar{padding:16px 12px;overflow-x:auto;}
    .step-label, .sl{font-size:10px;}
    .section{padding:0 16px 60px;}
    .card{padding:16px;}
    .card-sm{padding:12px;}
    /* Fix two-column layouts */
    .map-layout, .vw-layout, .hanoi-layout, .maze-layout, .tsp-layout{
      grid-template-columns:1fr !important;
    }
    /* Fix state space grid overflow */
    .states-grid{grid-template-columns:repeat(2,1fr);}
    /* Fix score breakdown */
    .score-breakdown, .sbd{grid-template-columns:repeat(3,1fr);}
    /* Fix canvas overflow */
    #tsp-canvas{width:100% !important;height:auto !important;}
    #maze-canvas{width:100% !important;height:auto !important;}
    #romania-svg, #romania-svg-2{height:320px;}
    /* Fix hanoi pegs */
    .pegs-row{gap:0;overflow-x:auto;}
    .disk{font-size:10px;}
    /* Fix action grid */
    .action-grid{grid-template-columns:repeat(3,1fr);}
    /* Fix dpad */
    .dpad{grid-template-columns:repeat(3,40px);grid-template-rows:repeat(3,40px);}
    .dpad-btn{width:40px;height:40px;font-size:16px;}
    /* Fix 3-col compare grids */
    #paths-comparison, #routes-grid{grid-template-columns:1fr !important;}
    #from-state-picker{grid-template-columns:repeat(4,1fr);}
    /* Hero gradient fix for mobile */
    .hero-tag{font-size:10px;padding:3px 10px;}
    /* Formulation */
    .form-components, #fcomps{gap:12px;}
  }
  @media(max-width:480px){
    .hero h1{font-size:22px;}
    .section-title, .sec-title{font-size:18px;}
    .score-big, .score-big{font-size:52px;}
    .states-grid{grid-template-columns:repeat(2,1fr);}
    #paths-comparison, #routes-grid{grid-template-columns:1fr !important;}
  }


  @media(max-width:640px){
    nav{padding:11px 14px;}
    .hero h1{font-size:22px !important;}
    .hero p{font-size:13px;}
    .hero-tag{font-size:10px;padding:3px 10px;}
    .steps-bar{padding:12px 6px;overflow-x:auto;}
    .sc,.step-circle{width:32px !important;height:32px !important;font-size:11px !important;}
    .step-label,.sl{font-size:9px !important;}
    .sline,.step-line{margin-top:-16px !important;margin-bottom:16px !important;}
    .section{padding:0 12px 50px !important;}
    .sec-title,.section-title{font-size:17px !important;}
    .sec-sub,.section-subtitle{font-size:12px !important;}
    .card{padding:14px !important;}
    .card-sm{padding:10px !important;}
    .qbox,.question-box{padding:14px !important;}
    .qt,.question-text{font-size:14px !important;}
    .option{padding:10px 12px !important;font-size:13px !important;}
    .score-big,.score-big{font-size:52px !important;}
    .sbd,.score-breakdown{grid-template-columns:repeat(3,1fr) !important;}
    .hanoi-layout,.maze-layout,.tsp-layout{grid-template-columns:1fr !important;}
    #tsp-canvas{max-width:100% !important;}
    #maze-canvas{max-width:100% !important;}
    .pegs-row{overflow-x:auto;}
    .disk{font-size:10px !important;}
    .diff-btns{flex-wrap:wrap;}
    .hanoi-controls{flex-wrap:wrap;gap:8px;}
  }
</style>
</head>
<body>
<nav>
  <a href="index.html">‚Üê Back to Exercises</a>
  <div style="display:flex;gap:8px;"><span class="nav-badge">IT426 ¬∑ AI Systems</span><span class="nav-badge">KSU</span></div>
</nav>
<div class="hero">
  <div class="hero-tag">Exercise 06 ¬∑ Optimization</div>
  <h1>Traveling Salesman üåç</h1>
  <p>Build your own tour ‚Äî visit every city once and return home. Then see why this problem is so hard to solve optimally.</p>
</div>
<div class="steps-bar">
  <div class="step"><div class="sc active" id="sc1">1</div><div class="sl active" id="sl1">Build Tour</div></div>
  <div class="sline" id="sln1"></div>
  <div class="step"><div class="sc" id="sc2">2</div><div class="sl" id="sl2">State Explosion</div></div>
  <div class="sline" id="sln2"></div>
  <div class="step"><div class="sc" id="sc3">3</div><div class="sl" id="sl3">Compare Routes</div></div>
  <div class="sline" id="sln3"></div>
  <div class="step"><div class="sc" id="sc4">4</div><div class="sl" id="sl4">Formulate</div></div>
</div>

<!-- SEC 1: BUILD TOUR -->
<section class="section visible" id="sec1">
  <div class="sec-title">Step 1: Build Your Own Tour üó∫Ô∏è</div>
  <div class="sec-sub">Click the cities in order to create a tour. You must visit all 6 cities and return to the start. Try to minimize total distance!</div>
  <div class="card">
    <div class="tsp-layout">
      <div>
        <canvas id="tsp-canvas" width="460" height="360" style="max-width:100%;"></canvas>
        <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;align-items:center;">
          <button class="btn btn-g" onclick="tsp.reset()">üîÑ Reset Tour</button>
          <span style="font-size:13px;color:var(--text-muted);" id="tsp-hint">Click a city to start your tour</span>
        </div>
      </div>
      <div style="display:flex;flex-direction:column;gap:12px;">
        <div class="card-sm">
          <div class="state-label">Current State</div>
          <div class="code-block" id="tsp-state"><span class="code-comment">// (visited_list, current)</span>
visited = []
current = None</div>
        </div>
        <div class="card-sm">
          <div class="state-label">Your Route</div>
          <div id="route-steps" style="min-height:50px;"><div style="color:var(--text-muted);font-size:13px;">No cities visited yet</div></div>
          <div class="total-box" id="total-box" style="display:none;">
            <div class="total-val" id="total-dist">0</div>
            <div class="total-lbl">Total Distance</div>
            <div id="best-badge-wrap"></div>
          </div>
        </div>
        <div id="tour-complete-box" style="display:none;background:rgba(52,211,153,.1);border:1px solid var(--success);border-radius:12px;padding:14px;text-align:center;animation:fadeUp .4s ease;">
          <div style="font-size:16px;font-weight:700;color:var(--success);margin-bottom:6px;">‚úÖ Tour Complete!</div>
          <div style="font-size:13px;color:var(--text-dim);margin-bottom:12px;">Distance: <strong id="final-dist" style="color:var(--accent)">0</strong></div>
          <button class="btn btn-p" onclick="goTo(2)">See State Explosion ‚Üí</button>
        </div>
      </div>
    </div>
  </div>
  <div style="margin-top:14px;text-align:center;">
    <button class="btn btn-g" onclick="goTo(2)" style="font-size:12px;opacity:.6;">Skip ‚Üí</button>
  </div>
</section>

<!-- SEC 2: STATE EXPLOSION -->
<section class="section" id="sec2">
  <div class="sec-title">Step 2: The State Explosion Problem üí•</div>
  <div class="sec-sub">TSP is hard because the number of possible routes grows <em>factorially</em> ‚Äî way faster than exponential!</div>
  <div class="card" style="margin-bottom:24px;">
    <p style="font-size:14px;color:var(--text-dim);margin-bottom:20px;">For n cities, the number of distinct tours = <strong style="color:var(--accent);">(n‚àí1)! / 2</strong> (fixing start city and accounting for direction)</p>
    <table class="explosion-table">
      <thead><tr><th>Cities (n)</th><th>Formula</th><th>Distinct Tours</th><th>At 1M routes/sec‚Ä¶</th></tr></thead>
      <tbody>
        <tr><td>4</td><td>(4‚àí1)!/2</td><td>3</td><td>&lt;1 ms</td></tr>
        <tr><td>6</td><td>(6‚àí1)!/2</td><td>60</td><td>&lt;1 ms</td></tr>
        <tr><td>10</td><td>(10‚àí1)!/2</td><td class="highlight">181,440</td><td>&lt;1 sec</td></tr>
        <tr><td>15</td><td>(15‚àí1)!/2</td><td class="highlight">43,589,145,600</td><td>~12 hours</td></tr>
        <tr><td>20</td><td>(20‚àí1)!/2</td><td class="danger">60,822,550,204,416,000</td><td>~1.9 billion years</td></tr>
        <tr><td>30</td><td>(30‚àí1)!/2</td><td class="danger">4.4 √ó 10¬≥‚Å∞</td><td>longer than universe age</td></tr>
      </tbody>
    </table>
  </div>
  <div class="qbox">
    <div class="qt">‚ùì For 6 cities, how many distinct tours exist?</div>
    <div class="options" id="q2-opts">
      <button class="option" onclick="qSel('q2',this,'wrong')"><span class="ol">A</span><div>6! = 720 tours</div></button>
      <button class="option" onclick="qSel('q2',this,'wrong')"><span class="ol">B</span><div>6 tours (one per starting city)</div></button>
      <button class="option" onclick="qSel('q2',this,'correct')"><span class="ol">C</span><div>(6‚àí1)!/2 = 60 distinct tours</div></button>
      <button class="option" onclick="qSel('q2',this,'wrong')"><span class="ol">D</span><div>2‚Å∂ = 64 tours</div></button>
    </div>
    <div class="feedback" id="q2-fb"></div>
  </div>
  <div class="expl" id="q2-expl">
    <h3>‚úÖ 60 tours for 6 cities</h3>
    <ul>
      <li>Fix the start city (symmetry reduction) ‚Üí (n‚àí1)! permutations</li>
      <li>Each tour can be traversed in 2 directions ‚Üí divide by 2</li>
      <li>So: (6‚àí1)!/2 = 5!/2 = 120/2 = <strong>60 tours</strong></li>
      <li>This grows so fast that no computer can enumerate all tours for n &gt; 20</li>
    </ul>
    <div style="margin-top:14px;"><button class="btn btn-p" onclick="goTo(3)">Compare Routes ‚Üí</button></div>
  </div>
</section>

<!-- SEC 3: COMPARE ROUTES -->
<section class="section" id="sec3">
  <div class="sec-title">Step 3: Compare Possible Routes üìä</div>
  <div class="sec-sub">For 5 cities (A‚ÄìE), here are three different tours. Which is optimal?</div>
  <div class="card" style="margin-bottom:24px;">
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:20px;" id="routes-grid">
      <!-- generated -->
    </div>
    <div style="background:var(--surface2);border:1px solid var(--border);border-radius:12px;padding:16px;font-size:13px;color:var(--text-dim);">
      <strong style="color:var(--text);">Key Insight:</strong> The greedy approach (always go to nearest unvisited city) does NOT always give the optimal tour. Finding the true optimum requires checking all routes or using advanced algorithms like branch-and-bound or genetic algorithms.
    </div>
  </div>
  <div class="qbox">
    <div class="qt">‚ùì Why can't we simply always pick the nearest unvisited city (greedy approach) for TSP?</div>
    <div class="options" id="q3-opts">
      <button class="option" onclick="qSel('q3',this,'wrong')"><span class="ol">A</span><div>Because the nearest city might already be visited</div></button>
      <button class="option" onclick="qSel('q3',this,'correct')"><span class="ol">B</span><div>Because a locally optimal choice (nearest now) can lead to a much longer overall tour</div></button>
      <button class="option" onclick="qSel('q3',this,'wrong')"><span class="ol">C</span><div>Because there is no way to measure distance between cities</div></button>
    </div>
    <div class="feedback" id="q3-fb"></div>
  </div>
  <div class="expl" id="q3-expl">
    <h3>‚úÖ Greedy ‚â† Optimal for TSP</h3>
    <ul>
      <li>Greedy picks the best <strong>local</strong> choice at each step</li>
      <li>But this can trap the route into long jumps later to reach unvisited cities</li>
      <li>TSP requires <strong>global</strong> optimization ‚Äî you must consider all cities together</li>
      <li>This is why TSP is NP-hard: no known polynomial-time optimal algorithm exists</li>
    </ul>
    <div style="margin-top:14px;"><button class="btn btn-p" onclick="goTo(4)">Continue to Formulation ‚Üí</button></div>
  </div>
</section>

<!-- SEC 4: FORMULATE -->
<section class="section" id="sec4">
  <div class="sec-title">Step 4: Formulate the TSP üìã</div>
  <div class="sec-sub">Define all five components for the Traveling Salesman Problem with n cities.</div>
  <div id="fcomps">
    <div class="fcomp" id="fc1"><div class="ftitle"><div class="fnum">1</div>State Representation</div><div class="fdesc">What information fully describes a partial TSP tour?</div>
      <div class="options" id="fc1-o">
        <button class="option" onclick="fSel('fc1',this,'wrong')"><span class="ol">A</span><div>Just the current city</div></button>
        <button class="option" onclick="fSel('fc1',this,'correct')"><span class="ol">B</span><div>(current_city, set_of_visited_cities) ‚Äî both are needed to know valid next moves</div></button>
        <button class="option" onclick="fSel('fc1',this,'wrong')"><span class="ol">C</span><div>The total distance traveled so far</div></button>
      </div><div class="gfb" id="fc1-fb"></div>
    </div>
    <div class="fcomp" id="fc2"><div class="ftitle"><div class="fnum">2</div>Initial State</div><div class="fdesc">How does the tour begin?</div>
      <div class="options" id="fc2-o">
        <button class="option" onclick="fSel('fc2',this,'correct')"><span class="ol">A</span><div>(city_0, {city_0}) ‚Äî start at any city, which is immediately marked as visited</div></button>
        <button class="option" onclick="fSel('fc2',this,'wrong')"><span class="ol">B</span><div>All cities unvisited and no current city</div></button>
        <button class="option" onclick="fSel('fc2',this,'wrong')"><span class="ol">C</span><div>Start at the city with the most connections</div></button>
      </div><div class="gfb" id="fc2-fb"></div>
    </div>
    <div class="fcomp" id="fc3"><div class="ftitle"><div class="fnum">3</div>Actions</div><div class="fdesc">What moves are allowed at each step?</div>
      <div class="options" id="fc3-o">
        <button class="option" onclick="fSel('fc3',this,'wrong')"><span class="ol">A</span><div>Travel to any city in any order</div></button>
        <button class="option" onclick="fSel('fc3',this,'correct')"><span class="ol">B</span><div>Travel to any city NOT yet in the visited set (or back to start if all visited)</div></button>
        <button class="option" onclick="fSel('fc3',this,'wrong')"><span class="ol">C</span><div>Only travel to the nearest unvisited city</div></button>
      </div><div class="gfb" id="fc3-fb"></div>
    </div>
    <div class="fcomp" id="fc4"><div class="ftitle"><div class="fnum">4</div>Goal Test</div><div class="fdesc">When is the TSP tour complete?</div>
      <div class="options" id="fc4-o">
        <button class="option" onclick="fSel('fc4',this,'wrong')"><span class="ol">A</span><div>When the total distance is minimized</div></button>
        <button class="option" onclick="fSel('fc4',this,'correct')"><span class="ol">B</span><div>When all n cities have been visited AND the tour returns to the starting city</div></button>
        <button class="option" onclick="fSel('fc4',this,'wrong')"><span class="ol">C</span><div>When the agent can no longer move to an unvisited city</div></button>
      </div><div class="gfb" id="fc4-fb"></div>
    </div>
    <div class="fcomp" id="fc5"><div class="ftitle"><div class="fnum">5</div>Path Cost</div><div class="fdesc">How is the quality of a tour measured?</div>
      <div class="options" id="fc5-o">
        <button class="option" onclick="fSel('fc5',this,'wrong')"><span class="ol">A</span><div>Number of cities visited (always n, so not useful)</div></button>
        <button class="option" onclick="fSel('fc5',this,'wrong')"><span class="ol">B</span><div>Number of roads taken</div></button>
        <button class="option" onclick="fSel('fc5',this,'correct')"><span class="ol">C</span><div>Total distance of all edges in the tour ‚Äî minimizing this is the optimization goal</div></button>
      </div><div class="gfb" id="fc5-fb"></div>
    </div>
  </div>
  <button class="btn btn-p btn-f" onclick="grade()" style="margin-top:20px;font-size:16px;padding:14px;">‚úÖ Submit Answers</button>
  <div id="score-sec" style="display:none;margin-top:24px;animation:fadeUp .5s ease;">
    <div class="score-card">
      <div class="score-big" id="spct">‚Äî</div>
      <div class="score-lbl" id="smsg">‚Äî</div>
      <div class="sbd" id="sbd"></div>
      <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap;">
        <button class="btn btn-g" id="retry-btn" onclick="retry()" style="display:none;">‚Ü∫ Try Again</button>
        <button class="btn btn-p" id="comp-btn" onclick="goTo(5)" style="display:none;">Complete üéâ</button>
      </div>
    </div>
  </div>
</section>

<!-- SEC 5 -->
<section class="section" id="sec5">
  <div class="comp-card">
    <div style="font-size:72px;margin-bottom:20px;">üåç</div>
    <h2>All Exercises Complete!</h2>
    <p>You've mastered all six IT426 search problem formulations</p>
    <div class="badges">
      <div class="badge">‚úì TSP Explored</div>
      <div class="badge">‚úì (n‚àí1)!/2 Tours</div>
      <div class="badge">‚úì Greedy ‚â† Optimal</div>
      <div class="badge">‚úì Problem Formulated</div>
    </div>
    <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap;">
      <button class="btn btn-g" onclick="location.reload()">‚Ü∫ Start Over</button>
      <a href="index.html" class="btn btn-p" style="text-decoration:none;">‚Üê All Exercises</a>
    </div>
  </div>
</section>

<script>
// ‚îÄ‚îÄ CITIES DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const CITIES = [
  {name:'Riyadh',  x:230, y:280, color:'#f59e0b'},
  {name:'Jeddah',  x:80,  y:220, color:'#f472b6'},
  {name:'Mecca',   x:70,  y:280, color:'#a78bfa'},
  {name:'Medina',  x:100, y:130, color:'#60a5fa'},
  {name:'Dammam',  x:360, y:200, color:'#34d399'},
  {name:'Tabuk',   x:60,  y:60,  color:'#fb923c'},
];

function dist(a, b) {
  return Math.round(Math.sqrt((a.x-b.x)**2+(a.y-b.y)**2));
}

// Precompute distances
const DISTS = {};
CITIES.forEach((a,i) => CITIES.forEach((b,j) => {
  DISTS[`${i}-${j}`] = dist(a, b);
}));

// ‚îÄ‚îÄ TSP INTERACTIVE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const tsp = (() => {
  let visited = [];
  let tour = [];
  let totalDist = 0;
  let bestKnown = Infinity;

  function reset() {
    visited = []; tour = []; totalDist = 0;
    document.getElementById('tsp-hint').textContent = 'Click a city to start your tour';
    document.getElementById('route-steps').innerHTML = '<div style="color:var(--text-muted);font-size:13px;">No cities visited yet</div>';
    document.getElementById('total-box').style.display = 'none';
    document.getElementById('tour-complete-box').style.display = 'none';
    document.getElementById('tsp-state').innerHTML = `<span class="code-comment">// (visited_list, current)</span>\nvisited = []\ncurrent = None`;
    draw();
  }

  function clickCity(idx) {
    if (visited.includes(idx) && !(visited.length === CITIES.length && idx === visited[0])) return;
    if (visited.length === CITIES.length && idx !== visited[0]) {
      document.getElementById('tsp-hint').textContent = '‚ö†Ô∏è Must return to start city to complete tour!';
      return;
    }
    if (visited.length > 0) {
      const prev = visited[visited.length - 1];
      const d = DISTS[`${prev}-${idx}`];
      totalDist += d;
      tour.push({from: prev, to: idx, d});
    }
    if (visited.length === CITIES.length) {
      // closing tour
    } else {
      visited.push(idx);
    }
    draw();
    renderRoute();
    updateState();
    document.getElementById('tsp-hint').textContent = visited.length < CITIES.length
      ? `‚úì Visited ${CITIES[idx].name} ‚Äî ${CITIES.length - visited.length} cities left`
      : `‚úì Visited all cities ‚Äî return to ${CITIES[visited[0]].name}!`;
    if (visited.length === CITIES.length && tour.length === CITIES.length) {
      bestKnown = Math.min(bestKnown, totalDist);
      document.getElementById('tour-complete-box').style.display = 'block';
      document.getElementById('final-dist').textContent = totalDist;
    }
  }

  function draw() {
    const canvas = document.getElementById('tsp-canvas');
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Draw all city connections (faint)
    CITIES.forEach((a, i) => {
      CITIES.forEach((b, j) => {
        if (j <= i) return;
        ctx.beginPath();
        ctx.moveTo(a.x, a.y);
        ctx.lineTo(b.x, b.y);
        ctx.strokeStyle = 'rgba(46,51,82,.5)';
        ctx.lineWidth = 1;
        ctx.stroke();
        // Distance label
        ctx.fillStyle = '#2e3352';
        ctx.font = '10px JetBrains Mono, monospace';
        ctx.textAlign = 'center';
        ctx.fillText(DISTS[`${i}-${j}`], (a.x+b.x)/2, (a.y+b.y)/2);
      });
    });

    // Draw tour edges
    tour.forEach(({from, to, d}) => {
      const a = CITIES[from], b = CITIES[to];
      ctx.beginPath();
      ctx.moveTo(a.x, a.y);
      ctx.lineTo(b.x, b.y);
      ctx.strokeStyle = '#34d399';
      ctx.lineWidth = 3;
      ctx.stroke();
    });

    // Draw cities
    CITIES.forEach((city, i) => {
      const isVisited = visited.includes(i);
      const isCurrent = visited.length > 0 && visited[visited.length-1] === i;
      const isStart = visited.length > 0 && visited[0] === i;
      ctx.beginPath();
      ctx.arc(city.x, city.y, isCurrent ? 14 : 11, 0, Math.PI*2);
      ctx.fillStyle = isVisited ? city.color : '#22263a';
      ctx.fill();
      ctx.strokeStyle = isCurrent ? '#fff' : city.color;
      ctx.lineWidth = isCurrent ? 3 : 2;
      ctx.stroke();
      if (isCurrent) {
        ctx.beginPath();
        ctx.arc(city.x, city.y, 20, 0, Math.PI*2);
        ctx.strokeStyle = `${city.color}55`;
        ctx.lineWidth = 2;
        ctx.stroke();
      }
      ctx.fillStyle = isVisited ? '#fff' : '#8b90b8';
      ctx.font = `bold 12px Space Grotesk, sans-serif`;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(city.name, city.x, city.y + 26);
      if (isStart && visited.length > 0) {
        ctx.fillStyle = 'rgba(52,211,153,.3)';
        ctx.font = '10px Space Grotesk';
        ctx.fillText('START', city.x, city.y - 24);
      }
    });

    // Click handler
    canvas.onclick = function(e) {
      const rect = canvas.getBoundingClientRect();
      const sx = canvas.width / rect.width;
      const sy = canvas.height / rect.height;
      const mx = (e.clientX - rect.left) * sx;
      const my = (e.clientY - rect.top) * sy;
      CITIES.forEach((city, i) => {
        if (Math.sqrt((mx-city.x)**2+(my-city.y)**2) < 22) clickCity(i);
      });
    };
  }

  function renderRoute() {
    const el = document.getElementById('route-steps');
    el.innerHTML = '';
    visited.forEach((idx, i) => {
      const city = CITIES[idx];
      const d = i > 0 ? tour[i-1]?.d : null;
      const div = document.createElement('div');
      div.className = 'route-step';
      div.innerHTML = `
        <div class="city-dot" style="background:${city.color};"></div>
        <span style="font-weight:600;">${city.name}</span>
        ${d ? `<span class="route-dist">+${d}</span>` : '<span class="route-dist">Start</span>'}
      `;
      el.appendChild(div);
    });
    if (tour.length > 0) {
      document.getElementById('total-box').style.display = 'block';
      document.getElementById('total-dist').textContent = totalDist;
    }
  }

  function updateState() {
    const names = visited.map(i => CITIES[i].name);
    const cur = visited.length > 0 ? CITIES[visited[visited.length-1]].name : 'None';
    document.getElementById('tsp-state').innerHTML =
      `<span class="code-comment">// (visited_list, current)</span>\nvisited = [${names.map(n=>`"${n}"`).join(', ')}]\ncurrent = "${cur}"`;
  }

  return { reset };
})();

// ‚îÄ‚îÄ SECTION 3: ROUTES COMPARISON ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const SAMPLE_ROUTES = [
  {label:'Route A', cities:['Riyadh','Jeddah','Mecca','Medina','Tabuk','Dammam'], dist: 1043},
  {label:'Route B (Greedy)', cities:['Riyadh','Dammam','Medina','Tabuk','Jeddah','Mecca'], dist: 978},
  {label:'Route C (Optimal)', cities:['Riyadh','Dammam','Tabuk','Medina','Jeddah','Mecca'], dist: 891, optimal:true},
];

function buildRoutesGrid() {
  const grid = document.getElementById('routes-grid');
  SAMPLE_ROUTES.forEach(r => {
    const div = document.createElement('div');
    div.style.cssText = `background:var(--surface2);border:1px solid ${r.optimal?'rgba(52,211,153,.4)':'var(--border)'};border-radius:12px;padding:16px;`;
    div.innerHTML = `
      <div style="font-weight:700;font-size:14px;color:${r.optimal?'var(--accent)':'var(--text)'};margin-bottom:10px;">${r.label}</div>
      <div style="font-size:12px;color:var(--text-muted);margin-bottom:10px;">${r.cities.join(' ‚Üí ')} ‚Üí ${r.cities[0]}</div>
      <div style="font-size:28px;font-weight:700;color:${r.optimal?'var(--accent)':'var(--text-dim)'};font-family:'JetBrains Mono',monospace;">${r.dist}</div>
      ${r.optimal ? '<div style="font-size:11px;color:var(--accent);margin-top:4px;font-weight:700;">‚úì OPTIMAL</div>' : ''}
    `;
    grid.appendChild(div);
  });
}

// ‚îÄ‚îÄ Q&A ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function qSel(qid, btn, result) {
  document.getElementById(`${qid}-opts`).querySelectorAll('.option').forEach(o=>o.classList.remove('correct-ans','wrong-ans'));
  const fb = document.getElementById(`${qid}-fb`);
  if (result === 'correct') {
    btn.classList.add('correct-ans'); fb.className='feedback show correct';
    fb.innerHTML='<div class="fb-t">‚úÖ Correct!</div>';
    document.getElementById(`${qid}-expl`)?.classList.add('show');
    document.getElementById(`${qid}-opts`).querySelectorAll('.option').forEach(o=>o.disabled=true);
  } else {
    btn.classList.add('wrong-ans'); fb.className='feedback show wrong';
    fb.innerHTML='<div class="fb-t">‚ùå Not quite ‚Äî think again.</div>';
  }
}

// ‚îÄ‚îÄ FORMULATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const fa = {fc1:null,fc2:null,fc3:null,fc4:null,fc5:null};
const ff = {
  fc1:{correct:"‚úÖ Both current city AND visited set are needed ‚Äî without visited set, we can't know what's left.",wrong:"‚ùå Just the current city isn't enough ‚Äî we also need to track which cities have been visited."},
  fc2:{correct:"‚úÖ Start at any city (fix it for symmetry), mark it visited immediately.",wrong:"‚ùå We start at one city and mark it as visited ‚Äî the exact city choice is arbitrary (we usually fix city 0)."},
  fc3:{correct:"‚úÖ Move to any unvisited city, or return to start when all are visited.",wrong:"‚ùå Actions are: move to any city NOT in the visited set (greedy nearest is a strategy, not the action definition)."},
  fc4:{correct:"‚úÖ Complete tour = all cities visited + return to start.",wrong:"‚ùå The goal is a complete Hamiltonian cycle: all cities visited AND returned to the starting city."},
  fc5:{correct:"‚úÖ Path cost = total tour distance. Minimizing this is the whole point of TSP.",wrong:"‚ùå TSP optimizes total distance ‚Äî the number of cities visited is always n, so it's not a useful cost measure."}
};
function fSel(fc, btn, result) {
  document.getElementById(`${fc}-o`).querySelectorAll('.option').forEach(o=>o.classList.remove('correct-ans','wrong-ans'));
  btn.classList.add(result==='correct'?'correct-ans':'wrong-ans');
  fa[fc] = result;
}
function grade() {
  let correct=0;
  const names=['State Rep','Initial State','Actions','Goal Test','Path Cost'];
  const sbd=document.getElementById('sbd'); sbd.innerHTML='';
  ['fc1','fc2','fc3','fc4','fc5'].forEach((fc,i)=>{
    const ok=fa[fc]==='correct'; if(ok)correct++;
    document.getElementById(fc).classList.toggle('ok',ok); document.getElementById(fc).classList.toggle('bad',!ok);
    const fb=document.getElementById(`${fc}-fb`); fb.className=`gfb show ${ok?'ok':'bad'}`;
    fb.textContent=fa[fc]===null?'‚ö†Ô∏è No answer selected.':ff[fc][ok?'correct':'wrong'];
    sbd.innerHTML+=`<div class="si ${ok?'ok':'bad'}"><div class="si-icon">${ok?'‚úÖ':'‚ùå'}</div><div>${names[i]}</div></div>`;
  });
  const pct=Math.round(correct/5*100);
  document.getElementById('spct').textContent=`${pct}%`;
  document.getElementById('smsg').textContent=pct===100?'üèÜ Perfect!':pct>=80?'üéâ Excellent!':'üí™ Review and retry';
  document.getElementById('score-sec').style.display='block';
  document.getElementById('score-sec').scrollIntoView({behavior:'smooth'});
  document.getElementById(pct>=80?'comp-btn':'retry-btn').style.display='inline-flex';
}
function retry(){
  Object.keys(fa).forEach(k=>fa[k]=null);
  ['fc1','fc2','fc3','fc4','fc5'].forEach(fc=>{
    document.getElementById(fc).classList.remove('ok','bad');
    document.getElementById(`${fc}-fb`).className='gfb';
    document.getElementById(`${fc}-o`).querySelectorAll('.option').forEach(o=>o.classList.remove('correct-ans','wrong-ans'));
  });
  document.getElementById('score-sec').style.display='none';
  document.getElementById('retry-btn').style.display='none';
  document.getElementById('comp-btn').style.display='none';
  window.scrollTo({top:0,behavior:'smooth'});
}

// ‚îÄ‚îÄ NAV ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function goTo(n) {
  for(let i=1;i<=5;i++) document.getElementById(`sec${i}`)?.classList.remove('visible');
  document.getElementById(`sec${n}`)?.classList.add('visible');
  window.scrollTo({top:0,behavior:'smooth'});
  for(let i=1;i<=4;i++){
    const c=document.getElementById(`sc${i}`),l=document.getElementById(`sl${i}`),ln=document.getElementById(`sln${i}`);
    c.className='sc';l.className='sl';if(ln)ln.className='sline';
    if(i<n){c.classList.add('done');c.textContent='‚úì';l.classList.add('done');if(ln)ln.classList.add('done');}
    else if(i===n){c.classList.add('active');c.textContent=i;l.classList.add('active');}
    else{c.textContent=i;}
  }
}

tsp.reset();
buildRoutesGrid();
</script>
</body>
</html>