<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ER Navigation | IT426 Interactive Learning</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#080c14;--surface:#0e1420;--surface2:#141b28;--border:#1e2a3d;
  --red:#ef4444;--red2:#ff6b6b;--blue:#38bdf8;--green:#22c55e;
  --amber:#f59e0b;--purple:#a78bfa;
  --text:#e8f0fe;--text-dim:#6b7fa8;--text-muted:#2e3d58;
}
*{margin:0;padding:0;box-sizing:border-box;}
button{font-family:inherit;cursor:pointer;border:none;}
body{background:var(--bg);color:var(--text);font-family:'Outfit',sans-serif;min-height:100vh;overflow-x:hidden;}

/* SCANLINE EFFECT */
body::after{content:'';position:fixed;inset:0;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,.03) 2px,rgba(0,0,0,.03) 4px);pointer-events:none;z-index:9999;}

/* NAV */
nav{background:rgba(8,12,20,.95);border-bottom:1px solid var(--border);padding:12px 20px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;backdrop-filter:blur(12px);}
nav a{color:var(--red2);text-decoration:none;font-size:13px;font-weight:600;display:flex;align-items:center;gap:5px;}
nav a:hover{opacity:.7;}
.nav-badge{background:var(--surface2);border:1px solid var(--border);padding:4px 11px;border-radius:16px;font-size:11px;color:var(--text-dim);}

/* HERO */
.hero{text-align:center;padding:44px 20px 32px;position:relative;overflow:hidden;}
.hero::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse 60% 50% at 50% 0%,rgba(239,68,68,.14),transparent 65%);}
.pulse-ring{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:400px;height:400px;border-radius:50%;border:1px solid rgba(239,68,68,.06);animation:pulseRing 3s ease-out infinite;}
.pulse-ring:nth-child(2){animation-delay:.8s;width:600px;height:600px;}
@keyframes pulseRing{0%{opacity:.6;transform:translate(-50%,-50%) scale(.8);}100%{opacity:0;transform:translate(-50%,-50%) scale(1.3);}}
.level-tag{position:relative;display:inline-flex;align-items:center;gap:7px;background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.4);color:var(--red2);padding:5px 14px;border-radius:30px;font-size:11px;font-weight:700;letter-spacing:.07em;text-transform:uppercase;margin-bottom:18px;}
.level-dot{width:7px;height:7px;border-radius:50%;background:var(--red2);animation:blink 1.2s ease-in-out infinite;}
@keyframes blink{0%,100%{opacity:1;}50%{opacity:.2;}}
.hero h1{position:relative;font-size:clamp(24px,5vw,50px);font-weight:800;line-height:1.1;margin-bottom:12px;}
.hero h1 em{font-style:normal;background:linear-gradient(135deg,var(--red2),var(--amber));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.hero p{position:relative;color:var(--text-dim);font-size:14px;max-width:500px;margin:0 auto;line-height:1.6;}

/* PROGRESS */
.progress-wrap{max-width:750px;margin:0 auto;padding:20px 20px 0;}
.progress-track{display:flex;align-items:center;}
.prog-step{display:flex;flex-direction:column;align-items:center;gap:4px;flex:1;}
.prog-dot{width:32px;height:32px;border-radius:50%;border:2px solid var(--border);background:var(--surface);display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:var(--text-muted);transition:all .4s;z-index:2;flex-shrink:0;}
.prog-dot.active{border-color:var(--red2);background:var(--red2);color:#fff;box-shadow:0 0 16px rgba(239,68,68,.5);}
.prog-dot.done{border-color:var(--green);background:var(--green);color:#fff;}
.prog-label{font-size:8px;color:var(--text-muted);font-weight:700;text-align:center;text-transform:uppercase;letter-spacing:.04em;max-width:60px;line-height:1.3;}
.prog-label.active{color:var(--red2);}
.prog-label.done{color:var(--green);}
.prog-line{flex:1;height:2px;background:var(--border);margin-top:-16px;margin-bottom:16px;transition:background .4s;}
.prog-line.done{background:var(--green);}

/* SCENES */
.scene{max-width:820px;margin:0 auto;padding:22px 16px 80px;display:none;}
.scene.active{display:block;animation:fadeUp .5s ease;}
@keyframes fadeUp{from{opacity:0;transform:translateY(12px);}to{opacity:1;transform:translateY(0);}}

/* SCENE CARD */
.scene-card{background:var(--surface);border:1px solid var(--border);border-radius:20px;overflow:hidden;}
.scene-hdr{padding:18px 22px 14px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:12px;}
.scene-num{background:linear-gradient(135deg,var(--red),var(--red2));color:#fff;width:34px;height:34px;border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:800;flex-shrink:0;}
.scene-title{font-size:17px;font-weight:700;}
.scene-body{padding:20px 22px;}

/* HOSPITAL MAP */
.hospital-map{background:var(--bg);border:1px solid var(--border);border-radius:14px;overflow:hidden;margin-bottom:18px;}
.map-canvas{width:100%;display:block;}

/* ALERT BANNER */
.alert-banner{background:rgba(239,68,68,.08);border:1px solid rgba(239,68,68,.3);border-radius:12px;padding:14px 16px;display:flex;align-items:flex-start;gap:12px;margin-bottom:18px;}
.alert-icon{font-size:24px;flex-shrink:0;animation:alertPulse 1s ease-in-out infinite;}
@keyframes alertPulse{0%,100%{transform:scale(1);}50%{transform:scale(1.1);}}
.alert-text{font-size:14px;line-height:1.55;}
.alert-text strong{color:var(--red2);}

/* SPEECH */
.bubble{display:flex;gap:10px;align-items:flex-start;margin-bottom:16px;}
.bubble-avatar{font-size:28px;flex-shrink:0;line-height:1.2;}
.bubble-text{background:var(--surface2);border:1px solid var(--border);border-radius:0 12px 12px 12px;padding:11px 14px;font-size:13px;color:var(--text);line-height:1.55;flex:1;}
.bubble-text strong{color:var(--red2);}
.bubble-text .hl-blue{color:var(--blue);}
.bubble-text .hl-green{color:var(--green);}
.bubble-text .hl-amber{color:var(--amber);}

/* STATE BOX */
.state-box{background:var(--bg);border:1px solid var(--border);border-radius:12px;padding:13px 16px;font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--blue);white-space:pre-wrap;word-break:break-word;line-height:1.9;margin-bottom:14px;}
.sc{color:var(--text-muted);}
.sh{color:var(--red2);font-weight:600;}
.sg{color:var(--green);font-weight:600;}
.sa{color:var(--amber);}

/* QUESTION */
.qwrap{background:linear-gradient(135deg,rgba(239,68,68,.07),rgba(245,158,11,.03));border:1px solid rgba(239,68,68,.25);border-radius:16px;padding:18px;margin-bottom:14px;}
.qt{font-size:15px;font-weight:700;margin-bottom:14px;display:flex;gap:8px;}
.qt::before{content:'?';background:var(--red);color:#fff;width:22px;height:22px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:800;flex-shrink:0;margin-top:1px;}
.choices{display:flex;flex-direction:column;gap:7px;}
.choice{background:var(--surface2);border:2px solid var(--border);border-radius:11px;padding:11px 14px;cursor:pointer;transition:all .2s;display:flex;align-items:flex-start;gap:9px;font-size:13px;font-weight:500;text-align:left;width:100%;color:var(--text);}
.choice:hover:not(:disabled){border-color:var(--red2);background:rgba(239,68,68,.07);}
.choice.correct{border-color:var(--green);background:rgba(34,197,94,.1);color:var(--green);}
.choice.wrong{border-color:var(--red);background:rgba(239,68,68,.08);color:#fca5a5;}
.choice.neutral{border-color:var(--amber);background:rgba(245,158,11,.07);color:var(--amber);}
.ck{background:var(--surface);border-radius:6px;width:24px;height:24px;min-width:24px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;font-family:'JetBrains Mono',monospace;color:var(--text-muted);border:1px solid var(--border);}
.choice.correct .ck{background:var(--green);color:#fff;border-color:var(--green);}
.choice.wrong .ck{background:var(--red);color:#fff;border-color:var(--red);}
.choice.neutral .ck{background:var(--amber);color:#000;border-color:var(--amber);}
.choice-sub{font-size:11px;color:var(--text-muted);margin-top:2px;font-weight:400;}

/* MULTI */
.mchoice{background:var(--surface2);border:2px solid var(--border);border-radius:11px;padding:10px 13px;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:9px;font-size:13px;font-weight:500;width:100%;color:var(--text);}
.mchoice:hover{border-color:var(--red2);}
.mchoice.sel{border-color:var(--red2);background:rgba(239,68,68,.08);}
.mchoice.correct{border-color:var(--green);background:rgba(34,197,94,.1);color:var(--green);}
.mchoice.wrong{border-color:var(--red);background:rgba(239,68,68,.07);color:#fca5a5;}
.mbox{width:20px;height:20px;border-radius:5px;border:2px solid var(--border);background:var(--surface);display:flex;align-items:center;justify-content:center;font-size:11px;flex-shrink:0;transition:all .2s;}
.mchoice.sel .mbox{background:var(--red2);border-color:var(--red2);color:#fff;}
.mchoice.correct .mbox{background:var(--green);border-color:var(--green);color:#fff;}
.mchoice.wrong .mbox{background:var(--red);border-color:var(--red);color:#fff;}

/* FEEDBACK */
.feedback{display:none;border-radius:11px;padding:12px 15px;margin-top:12px;font-size:13px;line-height:1.55;}
.feedback.show{display:block;animation:fadeUp .3s ease;}
.feedback.correct{background:rgba(34,197,94,.1);border:1px solid rgba(34,197,94,.3);color:#86efac;}
.feedback.wrong{background:rgba(239,68,68,.07);border:1px solid rgba(239,68,68,.3);color:#fca5a5;}
.fb-t{font-weight:700;margin-bottom:4px;}

/* INSIGHT */
.insight{background:linear-gradient(135deg,rgba(56,189,248,.07),rgba(167,139,250,.05));border:1px solid rgba(56,189,248,.25);border-radius:14px;padding:14px 16px;margin-top:12px;}
.insight-t{font-size:12px;font-weight:700;color:var(--blue);margin-bottom:7px;display:flex;align-items:center;gap:6px;text-transform:uppercase;letter-spacing:.04em;}
.insight p{font-size:13px;color:var(--text-dim);line-height:1.6;}
.insight strong{color:var(--text);}

/* COMPARISON TABLE */
.compare-table{width:100%;border-collapse:collapse;margin:14px 0;}
.compare-table th{background:var(--surface2);padding:10px 14px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.05em;color:var(--text-muted);text-align:left;}
.compare-table th:first-child{border-radius:8px 0 0 0;}
.compare-table th:last-child{border-radius:0 8px 0 0;}
.compare-table td{padding:11px 14px;font-size:13px;border-bottom:1px solid var(--border);}
.compare-table tr:last-child td{border:none;}
.compare-table td:first-child{color:var(--text-muted);font-size:12px;font-weight:700;}
.tag-red{display:inline-flex;align-items:center;gap:4px;background:rgba(239,68,68,.12);color:var(--red2);padding:2px 8px;border-radius:6px;font-size:11px;font-weight:700;}
.tag-green{display:inline-flex;align-items:center;gap:4px;background:rgba(34,197,94,.1);color:var(--green);padding:2px 8px;border-radius:6px;font-size:11px;font-weight:700;}
.tag-amber{display:inline-flex;align-items:center;gap:4px;background:rgba(245,158,11,.1);color:var(--amber);padding:2px 8px;border-radius:6px;font-size:11px;font-weight:700;}

/* TRANS VISUAL */
.trans-row{display:flex;align-items:stretch;gap:8px;margin:12px 0;flex-wrap:wrap;}
.trans-box{background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:10px 13px;font-size:11px;font-family:'JetBrains Mono',monospace;color:var(--blue);flex:1;min-width:130px;}
.trans-mid{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;flex-shrink:0;}
.trans-act{background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.3);color:var(--red2);padding:3px 9px;border-radius:7px;font-size:11px;font-weight:700;white-space:nowrap;}
.trans-arr{color:var(--red2);font-size:18px;}

/* COST CARDS */
.cost-row{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin:12px 0;}
.cost-card{background:var(--surface2);border:2px solid var(--border);border-radius:12px;padding:14px 10px;text-align:center;transition:all .3s;}
.cost-card.active{border-color:var(--red2);background:rgba(239,68,68,.07);}
.cost-card.winner{border-color:var(--green);background:rgba(34,197,94,.07);}
.cost-icon{font-size:24px;margin-bottom:6px;}
.cost-val{font-size:20px;font-weight:800;font-family:'JetBrains Mono',monospace;color:var(--red2);}
.cost-card.winner .cost-val{color:var(--green);}
.cost-lbl{font-size:11px;color:var(--text-dim);margin-top:3px;}
.cost-why{font-size:10px;color:var(--text-muted);margin-top:5px;line-height:1.4;}

/* CONSTRAINT BOX */
.constraint-box{background:rgba(245,158,11,.06);border:1px solid rgba(245,158,11,.25);border-radius:12px;padding:14px 16px;margin:12px 0;}
.constraint-title{font-size:12px;font-weight:700;color:var(--amber);margin-bottom:10px;text-transform:uppercase;letter-spacing:.05em;}
.constraint-item{display:flex;align-items:flex-start;gap:8px;font-size:13px;color:var(--text-dim);margin-bottom:7px;line-height:1.5;}
.constraint-item:last-child{margin:0;}
.constraint-item::before{content:'‚ö†';color:var(--amber);flex-shrink:0;}

/* SUMMARY */
.summary-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px;}
.sum-card{background:var(--surface2);border:1px solid var(--border);border-radius:12px;padding:14px;}
.sum-label{font-size:10px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.07em;font-weight:700;margin-bottom:8px;}
.sum-val{font-size:13px;color:var(--text);font-family:'JetBrains Mono',monospace;line-height:1.7;word-break:break-word;}

/* COMPLETE */
.complete-card{text-align:center;padding:44px 20px;background:linear-gradient(135deg,rgba(239,68,68,.1),rgba(34,197,94,.06));border:1px solid rgba(239,68,68,.3);border-radius:20px;margin-top:16px;}
.complete-card h2{font-size:26px;font-weight:800;margin-bottom:10px;}
.complete-card p{color:var(--text-dim);font-size:14px;margin-bottom:22px;}
.badges{display:flex;justify-content:center;gap:8px;flex-wrap:wrap;margin-bottom:22px;}
.badge{background:var(--surface2);border:1px solid var(--border);padding:8px 12px;border-radius:9px;font-size:11px;color:var(--red2);font-weight:700;}

/* VS PIZZA */
.vs-box{background:var(--surface2);border:1px solid var(--border);border-radius:14px;overflow:hidden;margin:14px 0;}
.vs-row{display:grid;grid-template-columns:1fr 40px 1fr;}
.vs-col{padding:12px 14px;}
.vs-col.pizza{border-right:1px solid var(--border);}
.vs-hdr{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.05em;color:var(--text-muted);margin-bottom:8px;}
.vs-item{font-size:12px;color:var(--text-dim);padding:3px 0;border-bottom:1px solid var(--border);font-family:'JetBrains Mono',monospace;}
.vs-item:last-child{border:none;}
.vs-mid{display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:800;color:var(--text-muted);}
.vs-hdr.er{color:var(--red2);}

/* BUTTONS */
.btn{padding:11px 20px;border-radius:10px;font-family:'Outfit',sans-serif;font-size:13px;font-weight:700;cursor:pointer;transition:all .2s;display:inline-flex;align-items:center;gap:7px;}
.btn-red{background:linear-gradient(135deg,var(--red),var(--red2));color:#fff;box-shadow:0 4px 14px rgba(239,68,68,.3);}
.btn-red:hover{transform:translateY(-1px);box-shadow:0 6px 18px rgba(239,68,68,.4);}
.btn-ghost{background:var(--surface2);color:var(--text-dim);border:1px solid var(--border);}
.btn-ghost:hover{background:var(--border);}
.btn-check{background:rgba(239,68,68,.1);color:var(--red2);border:1px solid rgba(239,68,68,.3);}
.btn-check:hover{background:rgba(239,68,68,.2);}
.btn-full{width:100%;justify-content:center;}

/* NEXT */
#next1,#next2,#next3,#next4,#next5{display:none;margin-top:14px;text-align:center;}

/* Mobile */
@media(max-width:600px){
  .hero{padding:30px 14px 22px;}
  .scene{padding:14px 12px 60px;}
  .scene-body{padding:16px 14px;}
  .cost-row{grid-template-columns:1fr;}
  .summary-grid{grid-template-columns:1fr;}
  .vs-row{grid-template-columns:1fr;}
  .vs-col.pizza{border-right:none;border-bottom:1px solid var(--border);}
  .vs-mid{display:none;}
  .trans-row{flex-direction:column;}
  .trans-arr{transform:rotate(90deg);}
}
::-webkit-scrollbar{width:5px;}::-webkit-scrollbar-track{background:var(--surface);}::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px;}
</style>
</head>
<body>
<nav>
  <a href="index.html">‚Üê Back to Exercises</a>
  <div style="display:flex;gap:8px;"><span class="nav-badge">IT426 ¬∑ AI Systems</span><span class="nav-badge">KSU</span></div>
</nav>

<div class="hero">
  <div class="pulse-ring"></div><div class="pulse-ring"></div>
  <div class="level-tag"><div class="level-dot"></div>Advanced Story ¬∑ Problem Formulation</div>
  <h1>The <em>Emergency Room</em> Problem</h1>
  <p>A patient needs urgent care ‚Äî navigate the hospital, handle constraints, and find the fastest path. Same 5 components, much harder problem.</p>
</div>

<div class="progress-wrap">
  <div class="progress-track">
    <div class="prog-step"><div class="prog-dot active" id="pd1">1</div><div class="prog-label active" id="pl1">State</div></div>
    <div class="prog-line" id="pln1"></div>
    <div class="prog-step"><div class="prog-dot" id="pd2">2</div><div class="prog-label" id="pl2">Actions</div></div>
    <div class="prog-line" id="pln2"></div>
    <div class="prog-step"><div class="prog-dot" id="pd3">3</div><div class="prog-label" id="pl3">Transition</div></div>
    <div class="prog-line" id="pln3"></div>
    <div class="prog-step"><div class="prog-dot" id="pd4">4</div><div class="prog-label" id="pl4">Goal Test</div></div>
    <div class="prog-line" id="pln4"></div>
    <div class="prog-step"><div class="prog-dot" id="pd5">5</div><div class="prog-label" id="pl5">Path Cost</div></div>
    <div class="prog-line" id="pln5"></div>
    <div class="prog-step"><div class="prog-dot" id="pd6">6</div><div class="prog-label" id="pl6">Summary</div></div>
  </div>
</div>

<!-- ‚ïê‚ïê SCENE 1: STATE ‚ïê‚ïê -->
<div class="scene active" id="scene1">
  <div class="scene-card">
    <div class="scene-hdr"><div class="scene-num">1</div><div class="scene-title">üö® Emergency! Patient Arrives</div></div>
    <div class="scene-body">
      <div class="alert-banner">
        <div class="alert-icon">üö®</div>
        <div class="alert-text"><strong>CODE RED</strong> ‚Äî Patient: Male, 45y, chest pain. Just arrived at Entrance. Needs to reach the Cardiac ICU. Elevator B is under maintenance. ICU-2 is at full capacity.</div>
      </div>

      <div class="bubble"><div class="bubble-avatar">üë®‚Äç‚öïÔ∏è</div>
        <div class="bubble-text">This is more complex than delivering pizza. The state has to capture <strong class="hl-blue">multiple variables</strong> at once ‚Äî not just location!</div>
      </div>

      <div class="hospital-map"><canvas class="map-canvas" id="map1" width="700" height="200"></canvas></div>

      <div class="state-box" id="s1display"><span class="sc">// What variables fully define this situation?</span>
state = ???</div>

      <div class="qwrap">
        <div class="qt">Which state representation is complete enough for the AI to plan?</div>
        <div class="choices" id="q1c">
          <button class="choice" onclick="a1(this,'wrong')"><span class="ck">A</span><div>Just the patient's current location (Entrance)</div></button>
          <button class="choice" onclick="a1(this,'wrong')"><span class="ck">B</span><div>Location + patient condition (Stable / Critical)<div class="choice-sub">Ignores elevator and room availability</div></div></button>
          <button class="choice" onclick="a1(this,'correct')"><span class="ck">C</span><div>Location + condition + elevator status + room availability<div class="choice-sub">All constraints that affect valid actions</div></div></button>
          <button class="choice" onclick="a1(this,'wrong')"><span class="ck">D</span><div>Location + all staff positions + all equipment status<div class="choice-sub">Too much ‚Äî irrelevant to this problem</div></div></button>
        </div>
        <div class="feedback" id="fb1"></div>
      </div>

      <div class="insight" id="ins1" style="display:none;">
        <div class="insight-t">üí° Why This Is Harder Than Pizza</div>
        <p>In pizza delivery, state = (location, orders). Here the state needs to include <strong>environmental constraints</strong> that directly affect which actions are valid. A broken elevator changes what moves are possible. A full ICU changes what the goal means. The state must capture <strong>everything that can change the agent's options.</strong></p>
      </div>

      <div id="next1"><button class="btn btn-red" onclick="goScene(2)">Next: What Actions Are Available? ‚Üí</button></div>
    </div>
  </div>
  <div style="margin-top:10px;text-align:center;"><button class="btn btn-ghost" onclick="goScene(2)" style="font-size:11px;opacity:.5;">Skip ‚Üí</button></div>
</div>

<!-- ‚ïê‚ïê SCENE 2: ACTIONS ‚ïê‚ïê -->
<div class="scene" id="scene2">
  <div class="scene-card">
    <div class="scene-hdr"><div class="scene-num">2</div><div class="scene-title">üèÉ Which Routes Can the Team Take?</div></div>
    <div class="scene-body">
      <div class="bubble"><div class="bubble-avatar">üöë</div>
        <div class="bubble-text">From the Entrance, the team has multiple paths. But <strong>not all actions are valid</strong> ‚Äî some depend on the current state of the hospital.</div>
      </div>

      <div class="hospital-map"><canvas class="map-canvas" id="map2" width="700" height="200"></canvas></div>

      <div class="constraint-box">
        <div class="constraint-title">‚ö† Active Constraints</div>
        <div class="constraint-item">Elevator B is under maintenance ‚Üí cannot be used</div>
        <div class="constraint-item">ICU-2 is at full capacity ‚Üí cannot admit new patients</div>
        <div class="constraint-item">Stairs require patient to be Stable ‚Üí Critical patients cannot use stairs</div>
      </div>

      <div class="qwrap">
        <div class="qt">Patient is CRITICAL. From Entrance, which actions are currently valid?</div>
        <div class="choices" id="q2c" style="display:flex;flex-direction:column;gap:7px;">
          <button class="mchoice" onclick="m2tog(this,true)" data-v="a"><span class="mbox"></span>üõó Take Elevator A to Floor 2</button>
          <button class="mchoice" onclick="m2tog(this,false)" data-v="b"><span class="mbox"></span>üõó Take Elevator B to Floor 2 <span style="color:var(--text-muted);font-size:11px;margin-left:6px;">(maintenance)</span></button>
          <button class="mchoice" onclick="m2tog(this,false)" data-v="c"><span class="mbox"></span>ü™ú Use Stairs to Floor 2 <span style="color:var(--text-muted);font-size:11px;margin-left:6px;">(critical patient)</span></button>
          <button class="mchoice" onclick="m2tog(this,true)" data-v="d"><span class="mbox"></span>üèÉ Move to Triage Room (same floor)</button>
          <button class="mchoice" onclick="m2tog(this,false)" data-v="e"><span class="mbox"></span>üè• Admit to ICU-2 directly <span style="color:var(--text-muted);font-size:11px;margin-left:6px;">(full)</span></button>
        </div>
        <div style="margin-top:12px;"><button class="btn btn-check btn-full" id="q2sub" onclick="c2()">‚úì Confirm Selection</button></div>
        <div class="feedback" id="fb2"></div>
      </div>

      <div class="insight" id="ins2" style="display:none;">
        <div class="insight-t">üí° State-Dependent Actions</div>
        <p>In pizza delivery, actions were always the same (Drive to H1/H2/H3). Here, <strong>valid actions change based on the current state</strong>. If the elevator is broken, that action disappears. If the patient becomes stable, stairs unlock. This is called a <strong>state-dependent action space</strong> ‚Äî much more realistic!</p>
      </div>

      <div id="next2"><button class="btn btn-red" onclick="goScene(3)">Next: Watch the State Change ‚Üí</button></div>
    </div>
  </div>
  <div style="margin-top:10px;text-align:center;"><button class="btn btn-ghost" onclick="goScene(3)" style="font-size:11px;opacity:.5;">Skip ‚Üí</button></div>
</div>

<!-- ‚ïê‚ïê SCENE 3: TRANSITION ‚ïê‚ïê -->
<div class="scene" id="scene3">
  <div class="scene-card">
    <div class="scene-hdr"><div class="scene-num">3</div><div class="scene-title">üîÑ One Action ‚Äî Multiple Things Change</div></div>
    <div class="scene-body">
      <div class="bubble"><div class="bubble-avatar">üë®‚Äç‚öïÔ∏è</div>
        <div class="bubble-text">Team moved the patient through <strong class="hl-blue">Elevator A ‚Üí Floor 2</strong>. Watch what changes in the state. It's not just location this time!</div>
      </div>

      <div class="hospital-map"><canvas class="map-canvas" id="map3" width="700" height="200"></canvas></div>

      <div class="trans-row">
        <div class="trans-box"><span style="color:var(--text-muted);">BEFORE</span>
loc      = Entrance
floor    = 1
cond     = Critical
elev_A   = Available
ICU_1    = Available
time     = 0 min</div>
        <div class="trans-mid">
          <div class="trans-act">Elevator A</div>
          <div class="trans-arr">‚Üí</div>
          <div class="trans-act">Floor 2</div>
        </div>
        <div class="trans-box" style="color:var(--green);"><span style="color:var(--text-muted);">AFTER</span>
loc      = Floor2_Corridor
floor    = 2
cond     = Critical
elev_A   = Available
ICU_1    = Available
time     = 3 min</div>
      </div>

      <div class="qwrap">
        <div class="qt">What changed in the state after taking Elevator A to Floor 2?</div>
        <div class="choices" id="q3c">
          <button class="choice" onclick="a3(this,'wrong')"><span class="ck">A</span>Only the location changed</button>
          <button class="choice" onclick="a3(this,'correct')"><span class="ck">B</span><div>Location + floor + time all changed<div class="choice-sub">3 variables updated simultaneously</div></div></button>
          <button class="choice" onclick="a3(this,'wrong')"><span class="ck">C</span>Location + condition changed (patient improved)</button>
          <button class="choice" onclick="a3(this,'wrong')"><span class="ck">D</span>Everything in the state changed</button>
        </div>
        <div class="feedback" id="fb3"></div>
      </div>

      <div class="insight" id="ins3" style="display:none;">
        <div class="insight-t">üí° Multi-Variable Transitions</div>
        <p>Pizza: one action changed 2 things (location + order removed). Here: one action changes <strong>3+ things</strong> (location, floor, time elapsed). The transition model must specify <strong>exactly what changes and what stays the same</strong>. And some changes cascade ‚Äî reaching a triage room might change the patient's condition from Critical to Stable, which then unlocks new actions!</p>
      </div>

      <div id="next3"><button class="btn btn-red" onclick="goScene(4)">Next: When Is the Patient Safe? ‚Üí</button></div>
    </div>
  </div>
  <div style="margin-top:10px;text-align:center;"><button class="btn btn-ghost" onclick="goScene(4)" style="font-size:11px;opacity:.5;">Skip ‚Üí</button></div>
</div>

<!-- ‚ïê‚ïê SCENE 4: GOAL TEST ‚ïê‚ïê -->
<div class="scene" id="scene4">
  <div class="scene-card">
    <div class="scene-hdr"><div class="scene-num">4</div><div class="scene-title">üéØ What Does "Mission Accomplished" Mean?</div></div>
    <div class="scene-body">
      <div class="bubble"><div class="bubble-avatar">üè•</div>
        <div class="bubble-text">In pizza delivery the goal was simple: <span class="hl-green">orders == {}</span>. Here the goal is <strong>more nuanced</strong> ‚Äî it's not just about reaching a room!</div>
      </div>

      <div class="hospital-map"><canvas class="map-canvas" id="map4" width="700" height="200"></canvas></div>

      <div class="qwrap">
        <div class="qt">Which condition truly satisfies the goal for this emergency?</div>
        <div class="choices" id="q4c">
          <button class="choice" onclick="a4(this,'wrong')"><span class="ck">A</span>Patient reaches any ICU room</button>
          <button class="choice" onclick="a4(this,'wrong')"><span class="ck">B</span>Patient reaches Cardiac ICU within 30 min</button>
          <button class="choice" onclick="a4(this,'correct')"><span class="ck">C</span><div>Patient in Cardiac ICU + room available + within time limit<div class="choice-sub">All three must be true simultaneously</div></div></button>
          <button class="choice" onclick="a4(this,'wrong')"><span class="ck">D</span>Patient's condition changes from Critical to Stable</button>
        </div>
        <div class="feedback" id="fb4"></div>
      </div>

      <div class="constraint-box" id="goal-detail" style="display:none;">
        <div class="constraint-title">The Complete Goal Test</div>
        <div class="constraint-item">location == Cardiac_ICU</div>
        <div class="constraint-item">room_available == True (not full capacity)</div>
        <div class="constraint-item">time_elapsed ‚â§ 30 minutes (golden hour)</div>
      </div>

      <div class="insight" id="ins4" style="display:none;">
        <div class="insight-t">üí° Compound Goal Tests</div>
        <p>Pizza goal: one condition. ER goal: <strong>three conditions must ALL be true</strong>. This is called a <strong>conjunctive goal</strong>. Reaching Cardiac ICU after 45 minutes = FAIL. Reaching it in 20 min but no room = FAIL. AI search algorithms must evaluate ALL conditions at every candidate state, not just one.</p>
      </div>

      <div id="next4"><button class="btn btn-red" onclick="goScene(5)">Next: What's the Real Cost? ‚Üí</button></div>
    </div>
  </div>
  <div style="margin-top:10px;text-align:center;"><button class="btn btn-ghost" onclick="goScene(5)" style="font-size:11px;opacity:.5;">Skip ‚Üí</button></div>
</div>

<!-- ‚ïê‚ïê SCENE 5: PATH COST ‚ïê‚ïê -->
<div class="scene" id="scene5">
  <div class="scene-card">
    <div class="scene-hdr"><div class="scene-num">5</div><div class="scene-title">‚è±Ô∏è Two Paths ‚Äî Which Is Better?</div></div>
    <div class="scene-body">
      <div class="bubble"><div class="bubble-avatar">üìä</div>
        <div class="bubble-text">There are <strong>two possible routes</strong> to the Cardiac ICU. The cost function decides which one the AI prefers. But here ‚Äî unlike pizza ‚Äî the cost function has <strong>life-or-death consequences.</strong></div>
      </div>

      <div class="hospital-map"><canvas class="map-canvas" id="map5" width="700" height="200"></canvas></div>

      <table class="compare-table">
        <tr><th>Route</th><th>Path</th><th>Time</th><th>Risk</th><th>Congestion</th></tr>
        <tr>
          <td><span class="tag-red">Route A</span></td>
          <td style="font-size:12px;">Entrance‚ÜíElevA‚ÜíFloor2‚ÜíCorridor‚ÜíCICU</td>
          <td><span class="tag-green">18 min</span></td>
          <td><span class="tag-green">Low</span></td>
          <td><span class="tag-amber">Medium</span></td>
        </tr>
        <tr>
          <td><span class="tag-amber">Route B</span></td>
          <td style="font-size:12px;">Entrance‚ÜíTriage‚ÜíElevA‚ÜíFloor2‚ÜíCICU</td>
          <td><span class="tag-amber">24 min</span></td>
          <td><span class="tag-green">Low</span></td>
          <td><span class="tag-green">Low</span></td>
        </tr>
      </table>

      <div class="qwrap">
        <div class="qt">If the hospital's cost function is: <code style="background:var(--surface);padding:2px 7px;border-radius:5px;font-size:11px;">cost = time √ó risk_factor</code> ‚Äî which path is optimal?</div>
        <div class="choices" id="q5c">
          <button class="choice" onclick="a5(this,'correct')"><span class="ck">A</span><div>Route A ‚Äî faster time, same risk = lower total cost<div class="choice-sub">18 √ó 1.0 = 18 vs 24 √ó 1.0 = 24</div></div></button>
          <button class="choice" onclick="a5(this,'wrong')"><span class="ck">B</span>Route B ‚Äî less congestion means safer for the patient</button>
          <button class="choice" onclick="a5(this,'neutral')"><span class="ck">C</span><div>Depends ‚Äî if we add a congestion penalty, answer could change<div class="choice-sub">This is also a valid insight!</div></div></button>
        </div>
        <div class="feedback" id="fb5"></div>
      </div>

      <div class="insight" id="ins5" style="display:none;">
        <div class="insight-t">üí° Weighted Cost Functions</div>
        <p>In the ER, cost functions can be <strong>multi-dimensional</strong>: time, risk, resource usage, staff availability. Changing the weights changes the optimal path. This is why real hospital AI systems use <strong>A* with admissible heuristics</strong> ‚Äî they must guarantee finding the minimum-cost path within the time constraint. The cost function design is often the hardest part of the problem formulation!</p>
      </div>

      <div id="next5"><button class="btn btn-red" onclick="goScene(6)">See Complete Formulation ‚Üí</button></div>
    </div>
  </div>
  <div style="margin-top:10px;text-align:center;"><button class="btn btn-ghost" onclick="goScene(6)" style="font-size:11px;opacity:.5;">Skip ‚Üí</button></div>
</div>

<!-- ‚ïê‚ïê SCENE 6: SUMMARY ‚ïê‚ïê -->
<div class="scene" id="scene6">
  <div class="scene-card">
    <div class="scene-hdr"><div class="scene-num">6</div><div class="scene-title">üìã Full Formulation + Comparison</div></div>
    <div class="scene-body">

      <div class="summary-grid">
        <div class="sum-card">
          <div class="sum-label">Initial State</div>
          <div class="sum-val">(Entrance, Critical,<br>ElevB=broken,<br>ICU2=full, t=0)</div>
        </div>
        <div class="sum-card">
          <div class="sum-label">Actions</div>
          <div class="sum-val">Move(room),<br>TakeElevator(id),<br>UseStairs()*<br><span style="color:var(--text-muted);font-size:10px;">*if condition=Stable</span></div>
        </div>
        <div class="sum-card">
          <div class="sum-label">Transition Model</div>
          <div class="sum-val">Updates: loc, floor,<br>time, condition<br>(cascading changes)</div>
        </div>
        <div class="sum-card">
          <div class="sum-label">Goal Test</div>
          <div class="sum-val">loc==CICU AND<br>room_avail==True<br>AND time ‚â§ 30min</div>
        </div>
      </div>

      <div class="state-box"><span class="sc">// ER Problem ‚Äî Full Definition</span>
problem = {
  initial  : (Entrance, Critical, ElevB=<span class="sh">off</span>, ICU2=<span class="sh">full</span>, t=0),
  actions  : [Move(r), Elevator(A), Stairs()*],
  result   : action ‚Üí (new_loc, new_floor, t+Œît, ...),
  goal     : loc==<span class="sg">CICU</span> AND available AND t‚â§<span class="sa">30</span>,
  cost     : Œ£ (time_per_step √ó risk_factor)
}</div>

      <!-- VS PIZZA COMPARISON -->
      <div style="font-size:12px;font-weight:700;color:var(--text-muted);text-transform:uppercase;letter-spacing:.05em;margin:16px 0 8px;">ER vs Pizza ‚Äî Complexity Comparison</div>
      <div class="vs-box">
        <div class="vs-row" style="background:var(--surface2);border-bottom:1px solid var(--border);">
          <div class="vs-col pizza"><div class="vs-hdr">üçï Pizza Delivery</div></div>
          <div class="vs-mid"></div>
          <div class="vs-col"><div class="vs-hdr er">üè• ER Navigation</div></div>
        </div>
        <div class="vs-row">
          <div class="vs-col pizza"><div class="vs-item">1 variable: location</div><div class="vs-item">Fixed action set</div><div class="vs-item">1-condition goal</div><div class="vs-item">1 cost metric</div><div class="vs-item">Static environment</div></div>
          <div class="vs-mid">vs</div>
          <div class="vs-col"><div class="vs-item">5+ variables: loc, cond, elevs, rooms, time</div><div class="vs-item">State-dependent actions</div><div class="vs-item">3-condition conjunctive goal</div><div class="vs-item">Weighted multi-factor cost</div><div class="vs-item">Dynamic: rooms fill, elevs break</div></div>
        </div>
      </div>

      <div class="complete-card">
        <div style="font-size:52px;margin-bottom:14px;">üè•</div>
        <h2>Advanced Story Complete!</h2>
        <p>You've applied all 5 components to a complex, real-world emergency scenario</p>
        <div class="badges">
          <div class="badge">‚úì Multi-Variable State</div>
          <div class="badge">‚úì Constrained Actions</div>
          <div class="badge">‚úì Cascading Transitions</div>
          <div class="badge">‚úì Compound Goal</div>
          <div class="badge">‚úì Weighted Cost</div>
        </div>
        <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap;">
          <button class="btn btn-ghost" onclick="location.reload()">‚Ü∫ Replay</button>
          <a href="pizza-delivery-module.html" class="btn btn-ghost" style="text-decoration:none;">‚Üê Review Pizza Story</a>
          <a href="index.html" class="btn btn-red" style="text-decoration:none;">All Exercises</a>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
/* ‚îÄ‚îÄ‚îÄ HOSPITAL MAP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
const ROOMS = {
  entrance:  {x:.08, y:.55, label:'Entrance',   color:'#38bdf8', floor:1},
  triage:    {x:.25, y:.75, label:'Triage',      color:'#f59e0b', floor:1},
  elevA:     {x:.38, y:.40, label:'Elev A ‚úì',   color:'#22c55e', floor:1},
  elevB:     {x:.52, y:.40, label:'Elev B ‚úó',   color:'#ef4444', floor:1},
  corridor:  {x:.55, y:.65, label:'Corridor',   color:'#8b90b8', floor:2},
  icu1:      {x:.72, y:.30, label:'ICU-1',       color:'#22c55e', floor:2},
  icu2:      {x:.72, y:.65, label:'ICU-2 Full', color:'#ef4444', floor:2},
  cicu:      {x:.90, y:.45, label:'Cardiac ICU', color:'#22c55e', floor:2},
};

const EDGES = [
  ['entrance','triage'],['entrance','elevA'],['entrance','elevB'],
  ['triage','elevA'],['elevA','corridor'],['elevB','corridor'],
  ['corridor','icu1'],['corridor','icu2'],['corridor','cicu'],['icu1','cicu'],
];

function drawHospital(id, opts={}) {
  const canvas = document.getElementById(id);
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  const W = canvas.offsetWidth || 700;
  const H = 200;
  canvas.width = W; canvas.height = H;
  ctx.clearRect(0,0,W,H);

  // Dark grid
  ctx.strokeStyle='#1e2a3d'; ctx.lineWidth=1;
  for(let x=0;x<W;x+=36){ctx.beginPath();ctx.moveTo(x,0);ctx.lineTo(x,H);ctx.stroke();}
  for(let y=0;y<H;y+=36){ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(W,y);ctx.stroke();}

  const {current=null, visited=[], pathEdges=[], broken=[]} = opts;

  // Floor label
  ctx.fillStyle='#1e2a3d'; ctx.font='bold 10px Outfit,sans-serif';
  ctx.fillText('FLOOR 1',W*.04,18); ctx.fillText('FLOOR 2',W*.55,18);
  // Divider
  ctx.beginPath(); ctx.moveTo(W*.47,0); ctx.lineTo(W*.47,H);
  ctx.strokeStyle='#1e2a3d'; ctx.setLineDash([4,4]); ctx.stroke(); ctx.setLineDash([]);

  // Edges
  EDGES.forEach(([a,b]) => {
    const ra=ROOMS[a], rb=ROOMS[b];
    const isPath = pathEdges.some(([x,y])=>(x===a&&y===b)||(x===b&&y===a));
    const isBroken = broken.includes(a)||broken.includes(b);
    ctx.beginPath();
    ctx.moveTo(ra.x*W, ra.y*H); ctx.lineTo(rb.x*W, rb.y*H);
    ctx.strokeStyle = isPath ? '#22c55e' : (isBroken?'#ef444430':'#1e2a3d');
    ctx.lineWidth = isPath ? 3 : 1.5;
    ctx.setLineDash(isBroken?[4,3]:[]);
    ctx.stroke(); ctx.setLineDash([]);
  });

  // Nodes
  Object.entries(ROOMS).forEach(([key, r]) => {
    const x=r.x*W, y=r.y*H;
    const isCurrent = current===key;
    const isVisited = visited.includes(key);
    const isBroken = broken.includes(key);
    const rad = key==='cicu'?14:10;

    if(isCurrent){
      ctx.beginPath(); ctx.arc(x,y,rad+8,0,Math.PI*2);
      ctx.fillStyle=r.color+'25'; ctx.fill();
    }
    ctx.beginPath(); ctx.arc(x,y,rad,0,Math.PI*2);
    ctx.fillStyle = isVisited?r.color:(isCurrent?r.color:'#0e1420');
    ctx.fill();
    ctx.strokeStyle = isBroken?'#ef4444':(isCurrent?'#fff':r.color);
    ctx.lineWidth = isCurrent?2.5:1.5;
    ctx.stroke();

    // Icon
    let icon = key==='entrance'?'üö™':key==='cicu'?'‚ù§Ô∏è':key==='triage'?'ü©∫':
               key==='elevA'?'üõó':key==='elevB'?'üö´':
               key==='icu2'?'üî¥':key==='icu1'?'üè•':'üè•';
    ctx.font=`${key==='cicu'?14:11}px sans-serif`;
    ctx.textAlign='center'; ctx.textBaseline='middle';
    ctx.fillText(icon,x,y);

    // Label
    const yOff = y > H*.6 ? -rad-12 : rad+13;
    ctx.fillStyle = isCurrent?'#fff':(isBroken?'#ef4444':'#6b7fa8');
    ctx.font=`bold 9px Outfit,sans-serif`;
    ctx.textBaseline='middle';
    ctx.fillText(r.label,x,y+yOff);
  });

  // Patient marker
  if(current){
    const r=ROOMS[current];
    ctx.font='16px sans-serif'; ctx.textAlign='center'; ctx.textBaseline='middle';
    ctx.fillText('üöë',r.x*W+18,r.y*H-18);
  }
}

function initMaps(){
  drawHospital('map1',{current:'entrance',broken:['elevB','icu2']});
  drawHospital('map2',{current:'entrance',broken:['elevB','icu2']});
  drawHospital('map3',{current:'corridor',visited:['entrance','elevA'],pathEdges:[['entrance','elevA'],['elevA','corridor']],broken:['elevB']});
  drawHospital('map4',{current:'cicu',visited:['entrance','elevA','corridor','cicu'],pathEdges:[['entrance','elevA'],['elevA','corridor'],['corridor','cicu']],broken:['elevB']});
  drawHospital('map5',{pathEdges:[['entrance','elevA'],['elevA','corridor'],['corridor','cicu']],broken:['elevB']});
}
window.addEventListener('load',initMaps);
window.addEventListener('resize',initMaps);

/* ‚îÄ‚îÄ‚îÄ Q1 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function a1(btn,r){
  document.querySelectorAll('#q1c .choice').forEach(b=>b.disabled=true);
  const fb=document.getElementById('fb1');
  if(r==='correct'){
    btn.classList.add('correct');
    fb.className='feedback show correct';
    fb.innerHTML='<div class="fb-t">‚úÖ Correct!</div>The state must include all variables that can restrict available actions. Elevator status and room capacity directly change what moves are possible ‚Äî they must be in the state.';
    document.getElementById('ins1').style.display='block';
    document.getElementById('s1display').innerHTML=`<span class="sc">// Complete Initial State</span>
state = {
  loc      : <span class="sh">Entrance</span>,
  condition: <span class="sh">Critical</span>,
  elev_B   : <span class="sh">broken</span>,
  ICU_2    : <span class="sh">full</span>,
  time     : <span class="sa">0 min</span>
}`;
    setTimeout(()=>document.getElementById('next1').style.display='block',600);
  } else {
    btn.classList.add('wrong');
    fb.className='feedback show wrong';
    fb.innerHTML='<div class="fb-t">‚ùå Incomplete.</div>Think about what information changes whether an action is valid or not. A broken elevator is not just context ‚Äî it removes an action from the available set!';
    document.querySelectorAll('#q1c .choice').forEach(b=>b.disabled=false);
  }
}

/* ‚îÄ‚îÄ‚îÄ Q2 MULTI ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
const q2sel=new Set();
function m2tog(btn,valid){
  const v=btn.dataset.v;
  if(q2sel.has(v)){q2sel.delete(v);btn.classList.remove('sel');btn.querySelector('.mbox').textContent='';}
  else{q2sel.add(v);btn.classList.add('sel');btn.querySelector('.mbox').textContent='‚úì';}
}
function c2(){
  const correct=new Set(['a','d']);
  const ok=[...correct].every(v=>q2sel.has(v))&&[...q2sel].every(v=>correct.has(v));
  document.querySelectorAll('#q2c .mchoice').forEach(btn=>{
    btn.disabled=true;
    const v=btn.dataset.v;
    if(correct.has(v)){btn.classList.add('correct');btn.querySelector('.mbox').textContent='‚úì';}
    else if(q2sel.has(v)){btn.classList.add('wrong');btn.querySelector('.mbox').textContent='‚úó';}
  });
  document.getElementById('q2sub').disabled=true;
  const fb=document.getElementById('fb2');
  if(ok){
    fb.className='feedback show correct';
    fb.innerHTML='<div class="fb-t">‚úÖ Exactly right!</div>Only Elevator A and moving to Triage are valid. Elevator B is broken, Stairs require Stable condition, and ICU-2 is full ‚Äî all three are blocked by the current state.';
    document.getElementById('ins2').style.display='block';
    setTimeout(()=>document.getElementById('next2').style.display='block',600);
  } else {
    fb.className='feedback show wrong';
    fb.innerHTML='<div class="fb-t">‚ùå Check the constraints.</div>Each invalid action has a reason in the current state. Re-read the constraint box carefully.';
    document.querySelectorAll('#q2c .mchoice').forEach(b=>{b.disabled=false;b.classList.remove('correct','wrong','sel');b.querySelector('.mbox').textContent=q2sel.has(b.dataset.v)?'‚úì':'';});
    document.getElementById('q2sub').disabled=false;
  }
}

/* ‚îÄ‚îÄ‚îÄ Q3 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function a3(btn,r){
  document.querySelectorAll('#q3c .choice').forEach(b=>b.disabled=true);
  const fb=document.getElementById('fb3');
  if(r==='correct'){
    btn.classList.add('correct');
    fb.className='feedback show correct';
    fb.innerHTML='<div class="fb-t">‚úÖ Correct!</div>Three variables changed: location (Entrance‚ÜíFloor2_Corridor), floor (1‚Üí2), and time (0‚Üí3 min). Condition stayed Critical ‚Äî not every variable changes with every action.';
    document.getElementById('ins3').style.display='block';
    setTimeout(()=>document.getElementById('next3').style.display='block',600);
  } else {
    btn.classList.add('wrong');
    fb.className='feedback show wrong';
    fb.innerHTML='<div class="fb-t">‚ùå Look carefully at the before/after.</div>Compare each variable ‚Äî which ones have different values after the action?';
    document.querySelectorAll('#q3c .choice').forEach(b=>b.disabled=false);
  }
}

/* ‚îÄ‚îÄ‚îÄ Q4 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function a4(btn,r){
  document.querySelectorAll('#q4c .choice').forEach(b=>b.disabled=true);
  const fb=document.getElementById('fb4');
  if(r==='correct'){
    btn.classList.add('correct');
    fb.className='feedback show correct';
    fb.innerHTML='<div class="fb-t">‚úÖ Correct!</div>All three conditions must hold simultaneously. Reaching Cardiac ICU but with no available bed ‚Äî not a solution. Reaching it in 35 minutes ‚Äî not a solution. The goal is a conjunction of constraints.';
    document.getElementById('goal-detail').style.display='block';
    document.getElementById('ins4').style.display='block';
    setTimeout(()=>document.getElementById('next4').style.display='block',600);
  } else {
    btn.classList.add('wrong');
    fb.className='feedback show wrong';
    fb.innerHTML='<div class="fb-t">‚ùå Partial goals fail.</div>In a real emergency, reaching the right room but too late, or finding it full ‚Äî both are failures. The goal test must check ALL conditions.';
    document.querySelectorAll('#q4c .choice').forEach(b=>b.disabled=false);
  }
}

/* ‚îÄ‚îÄ‚îÄ Q5 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function a5(btn,r){
  document.querySelectorAll('#q5c .choice').forEach(b=>b.disabled=true);
  const fb=document.getElementById('fb5');
  btn.classList.add(r==='correct'?'correct':r==='neutral'?'neutral':'wrong');
  if(r==='correct'){
    fb.className='feedback show correct';
    fb.innerHTML='<div class="fb-t">‚úÖ Correct with the given cost function!</div>With cost = time √ó risk_factor, and both routes having the same risk (1.0), Route A wins at 18 vs 24. But change the formula and the answer changes.';
  } else if(r==='neutral'){
    fb.className='feedback show correct';
    fb.innerHTML='<div class="fb-t">üí° Sharp thinking!</div>This is a valid insight ‚Äî the "optimal" path depends entirely on how you define the cost function. This is the key design challenge in real AI systems.';
  } else {
    fb.className='feedback show wrong';
    fb.innerHTML='<div class="fb-t">‚ùå With this cost function...</div>With cost = time √ó risk (and equal risk), Route A is strictly better. But your instinct about congestion is valid ‚Äî if we add a congestion weight, Route B could win.';
  }
  document.getElementById('ins5').style.display='block';
  setTimeout(()=>document.getElementById('next5').style.display='block',600);
}

/* ‚îÄ‚îÄ‚îÄ NAV ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
function goScene(n){
  document.querySelectorAll('.scene').forEach(s=>s.classList.remove('active'));
  document.getElementById(`scene${n}`)?.classList.add('active');
  window.scrollTo({top:0,behavior:'smooth'});
  updateProg(n);
  setTimeout(initMaps,80);
}

function updateProg(active){
  for(let i=1;i<=6;i++){
    const d=document.getElementById(`pd${i}`),l=document.getElementById(`pl${i}`),ln=document.getElementById(`pln${i}`);
    d.className='prog-dot';l.className='prog-label';if(ln)ln.className='prog-line';
    if(i<active){d.classList.add('done');d.textContent='‚úì';l.classList.add('done');if(ln)ln.classList.add('done');}
    else if(i===active){d.classList.add('active');d.textContent=i;l.classList.add('active');}
    else{d.textContent=i;}
  }
}
</script>
</body>
</html>