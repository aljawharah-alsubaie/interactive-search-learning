<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vacuum World | IT426 Interactive Learning</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#0f1117; --surface:#1a1d27; --surface2:#22263a; --border:#2e3352;
  --accent:#00d4aa; --accent2:#6c63ff; --warn:#f59e0b; --danger:#ef4444;
  --success:#10b981; --text:#e8eaf6; --text-dim:#8b90b8; --text-muted:#4a5080;
}
*{margin:0;padding:0;box-sizing:border-box;}
button{color:inherit;background:none;border:none;font-family:inherit;}
body{background:var(--bg);color:var(--text);font-family:'Space Grotesk',sans-serif;min-height:100vh;}

/* NAV */
nav{background:var(--surface);border-bottom:1px solid var(--border);padding:16px 32px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;}
nav a{color:var(--accent);text-decoration:none;font-size:14px;font-weight:500;display:flex;align-items:center;gap:6px;}
nav a:hover{opacity:.7;}
.nav-badge{background:var(--surface2);border:1px solid var(--border);padding:4px 12px;border-radius:20px;font-size:12px;color:var(--text-dim);}

/* HERO */
.hero{text-align:center;padding:60px 32px 40px;background:radial-gradient(ellipse 80% 60% at 50% 0%,rgba(0,212,170,.12) 0%,transparent 70%);}
.hero-tag{display:inline-block;background:rgba(0,212,170,.12);border:1px solid rgba(0,212,170,.4);color:var(--accent);padding:4px 14px;border-radius:20px;font-size:12px;font-weight:600;letter-spacing:.05em;text-transform:uppercase;margin-bottom:16px;}
.hero h1{font-size:clamp(26px,5vw,48px);font-weight:700;background:linear-gradient(135deg,#fff 40%,var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:12px;}
.hero p{color:var(--text-dim);font-size:16px;max-width:500px;margin:0 auto;}

/* STEPS */
.steps-bar{display:flex;align-items:center;justify-content:center;padding:32px;max-width:700px;margin:0 auto;}
.step{display:flex;flex-direction:column;align-items:center;gap:6px;flex:1;}
.step-circle{width:40px;height:40px;border-radius:50%;border:2px solid var(--border);background:var(--surface);display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;color:var(--text-muted);transition:all .4s;position:relative;z-index:2;}
.step-circle.active{border-color:var(--accent);background:var(--accent);color:#000;box-shadow:0 0 20px rgba(0,212,170,.4);}
.step-circle.done{border-color:var(--success);background:var(--success);color:#fff;}
.step-label{font-size:11px;color:var(--text-muted);font-weight:600;text-align:center;white-space:nowrap;transition:color .4s;}
.step-label.active{color:var(--accent);}
.step-label.done{color:var(--success);}
.step-line{flex:1;height:2px;background:var(--border);margin-top:-22px;margin-bottom:22px;z-index:1;transition:background .4s;}
.step-line.done{background:var(--success);}

/* SECTIONS */
.section{max-width:1000px;margin:0 auto;padding:0 24px 80px;display:none;}
.section.visible{display:block;animation:fadeUp .5s ease;}
@keyframes fadeUp{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
.section-title{font-size:24px;font-weight:700;margin-bottom:8px;}
.section-subtitle{color:var(--text-dim);font-size:14px;margin-bottom:32px;}

/* CARDS */
.card{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:24px;}
.card-sm{background:var(--surface2);border:1px solid var(--border);border-radius:12px;padding:16px;}

/* ‚îÄ‚îÄ VACUUM WORLD GRID ‚îÄ‚îÄ */
.vw-layout{display:grid;grid-template-columns:1fr 1fr;gap:32px;align-items:start;}
@media(max-width:700px){.vw-layout{grid-template-columns:1fr;}}

.vw-grid{display:grid;grid-template-columns:1fr 1fr;gap:4px;width:100%;max-width:380px;margin:0 auto;}
.vw-room{
  background:var(--surface2);border:2px solid var(--border);border-radius:12px;
  padding:20px 12px;text-align:center;position:relative;
  transition:all .3s ease;min-height:130px;
  display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px;
}
.vw-room.has-dirt{background:rgba(245,158,11,.06);border-color:rgba(245,158,11,.3);}
.vw-room.has-robot{border-color:var(--accent);background:rgba(0,212,170,.06);}
.vw-room.has-both{border-color:rgba(239,68,68,.5);background:rgba(239,68,68,.06);}
.room-label{font-size:24px;font-weight:700;color:var(--text-muted);}
.room-contents{font-size:30px;min-height:36px;display:flex;align-items:center;gap:4px;justify-content:center;}
.room-status{font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:.06em;padding:2px 8px;border-radius:10px;}
.status-dirty{background:rgba(245,158,11,.2);color:#fcd34d;}
.status-clean{background:rgba(16,185,129,.15);color:#6ee7b7;}

/* Transition animation */
.vw-room.flash-clean{animation:flashClean .5s ease;}
@keyframes flashClean{0%,100%{background:rgba(0,212,170,.06);}50%{background:rgba(0,212,170,.25);}}
.vw-room.flash-move{animation:flashMove .3s ease;}
@keyframes flashMove{0%,100%{transform:scale(1);}50%{transform:scale(1.03);}}

/* Action buttons */
.action-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:16px;}
.action-btn{
  background:var(--surface2);border:1px solid var(--border);border-radius:10px;
  padding:10px 8px;font-family:'Space Grotesk',sans-serif;font-size:13px;font-weight:600;
  color:var(--text-dim);cursor:pointer;transition:all .2s;text-align:center;
  -webkit-appearance:none;
}
.action-btn:hover{background:rgba(0,212,170,.1);border-color:var(--accent);color:var(--accent);}
.action-btn:active{transform:scale(.95);}
.action-btn.suck{background:rgba(245,158,11,.1);border-color:rgba(245,158,11,.4);color:#fcd34d;}
.action-btn.suck:hover{background:rgba(245,158,11,.2);}
.action-btn:disabled{opacity:.3;cursor:not-allowed;transform:none;}

/* State log */
.state-log{display:flex;flex-direction:column;gap:12px;}
.state-label{font-size:11px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.08em;font-weight:700;margin-bottom:6px;}
.code-block{background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:14px 16px;font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--accent);white-space:pre;line-height:1.7;overflow-x:auto;}
.code-comment{color:var(--text-muted);}

.history-log{background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:10px;max-height:150px;overflow-y:auto;}
.history-entry{padding:5px 8px;border-radius:6px;margin-bottom:3px;color:var(--text-dim);font-size:12px;display:flex;align-items:center;gap:8px;}
.history-entry:nth-child(odd){background:rgba(255,255,255,.02);}
.h-num{color:var(--text-muted);font-family:'JetBrains Mono',monospace;font-size:10px;min-width:20px;}
.h-action{background:rgba(0,212,170,.15);color:var(--accent);padding:1px 7px;border-radius:4px;font-weight:700;font-size:11px;}
.h-state{color:var(--text-muted);font-family:'JetBrains Mono',monospace;font-size:10px;margin-left:auto;}

/* Cost display */
.cost-bar{display:flex;gap:16px;align-items:center;background:var(--surface2);padding:14px 20px;border-radius:12px;border:1px solid var(--border);}
.cost-item{text-align:center;}
.cost-val{font-size:28px;font-weight:700;color:var(--accent);font-family:'JetBrains Mono',monospace;}
.cost-lbl{font-size:10px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.05em;font-weight:600;}

/* Goal banner */
.goal-banner{display:none;background:linear-gradient(135deg,rgba(16,185,129,.15),rgba(0,212,170,.1));border:1px solid var(--success);border-radius:14px;padding:20px;text-align:center;animation:fadeUp .4s ease;margin-top:16px;}
.goal-banner.show{display:block;}
.goal-banner h3{font-size:20px;color:var(--success);margin-bottom:8px;}
.goal-banner p{color:var(--text-dim);font-size:14px;margin-bottom:16px;}

/* QUESTIONS */
.question-box{background:linear-gradient(135deg,rgba(0,212,170,.06),rgba(108,99,255,.04));border:1px solid rgba(0,212,170,.25);border-radius:16px;padding:24px;margin-bottom:24px;}
.question-text{font-size:17px;font-weight:600;margin-bottom:18px;}
.options{display:flex;flex-direction:column;gap:10px;}
.option{background:var(--surface);border:2px solid var(--border);border-radius:12px;padding:14px 18px;cursor:pointer;transition:all .2s;display:flex;align-items:flex-start;gap:12px;font-size:14px;font-weight:500;text-align:left;width:100%;color:var(--text);}
.option:hover{border-color:var(--accent);background:rgba(0,212,170,.07);}
.option.selected{border-color:var(--accent);background:rgba(0,212,170,.1);}
.option.correct-ans{border-color:var(--success);background:rgba(16,185,129,.1);color:var(--success);}
.option.wrong-ans{border-color:var(--danger);background:rgba(239,68,68,.07);color:var(--danger);}
.opt-letter{background:var(--surface2);border-radius:6px;width:24px;height:24px;min-width:24px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:var(--text-dim);font-family:'JetBrains Mono',monospace;transition:all .2s;}
.option.selected .opt-letter{background:var(--accent);color:#000;}
.option.correct-ans .opt-letter{background:var(--success);color:#fff;}
.option.wrong-ans .opt-letter{background:var(--danger);color:#fff;}
.opt-sub{font-size:12px;color:var(--text-muted);margin-top:3px;font-weight:400;}

.feedback{display:none;border-radius:12px;padding:16px 20px;margin-top:16px;font-size:14px;line-height:1.6;animation:fadeUp .3s ease;}
.feedback.show{display:block;}
.feedback.correct{background:rgba(16,185,129,.1);border:1px solid rgba(16,185,129,.3);color:#6ee7b7;}
.feedback.wrong{background:rgba(239,68,68,.07);border:1px solid rgba(239,68,68,.3);color:#fca5a5;}
.feedback.warn{background:rgba(245,158,11,.07);border:1px solid rgba(245,158,11,.3);color:#fcd34d;}
.fb-title{font-weight:700;font-size:15px;margin-bottom:6px;}

.explanation-box{display:none;background:var(--surface2);border:1px solid var(--border);border-radius:14px;padding:20px;margin-top:20px;animation:fadeUp .4s ease;}
.explanation-box.show{display:block;}
.explanation-box h3{color:var(--accent);font-size:15px;margin-bottom:12px;}
.explanation-box ul{list-style:none;display:flex;flex-direction:column;gap:8px;}
.explanation-box li{display:flex;gap:10px;font-size:14px;color:var(--text-dim);}
.explanation-box li::before{content:"‚Üí";color:var(--accent);font-weight:700;flex-shrink:0;}

/* STATE SPACE GRID (all 8 states) */
.states-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin:20px 0;}
@media(max-width:600px){.states-grid{grid-template-columns:repeat(2,1fr);}}
.mini-state{background:var(--surface2);border:2px solid var(--border);border-radius:10px;padding:10px;text-align:center;cursor:pointer;transition:all .2s;color:var(--text);}
.mini-state:hover{border-color:var(--accent);}
.mini-state.highlighted{border-color:var(--accent);background:rgba(0,212,170,.1);}
.mini-state.goal-state{border-color:var(--success);background:rgba(16,185,129,.08);}
.mini-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:2px;width:48px;margin:0 auto 6px;}
.mini-cell{width:22px;height:22px;border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:10px;}
.mini-cell.robot{background:rgba(0,212,170,.3);font-size:14px;}
.mini-cell.dirt{background:rgba(245,158,11,.2);font-size:10px;}
.mini-cell.clean{background:var(--surface);}
.mini-cell.goal{background:rgba(16,185,129,.2);}
.mini-state-id{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text-muted);}

/* FORMULATION */
.form-components{display:flex;flex-direction:column;gap:20px;}
.form-comp{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:20px;transition:border-color .3s;}
.form-comp.graded-correct{border-color:var(--success);}
.form-comp.graded-wrong{border-color:var(--danger);}
.comp-title{font-size:15px;font-weight:700;margin-bottom:6px;display:flex;align-items:center;gap:8px;color:var(--text);}
.comp-num{background:var(--accent);color:#fff;width:26px;height:26px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;}
.comp-desc{font-size:13px;color:var(--text-dim);margin-bottom:14px;}
.grade-feedback{display:none;margin-top:10px;padding:10px 14px;border-radius:8px;font-size:13px;font-weight:500;}
.grade-feedback.show{display:block;}
.grade-feedback.ok{background:rgba(16,185,129,.12);color:#6ee7b7;border:1px solid rgba(16,185,129,.3);}
.grade-feedback.bad{background:rgba(239,68,68,.08);color:#fca5a5;border:1px solid rgba(239,68,68,.25);}

/* SCORE */
.score-card{text-align:center;padding:40px 20px;background:linear-gradient(135deg,rgba(0,212,170,.1),rgba(108,99,255,.08));border:1px solid rgba(0,212,170,.3);border-radius:20px;}
.score-big{font-size:80px;font-weight:700;font-family:'JetBrains Mono',monospace;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.score-label{color:var(--text-dim);font-size:16px;margin-bottom:32px;}
.score-breakdown{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;max-width:600px;margin:0 auto 32px;}
@media(max-width:600px){.score-breakdown{grid-template-columns:repeat(2,1fr);}}
.score-item{background:var(--surface2);border-radius:10px;padding:12px 8px;font-size:12px;color:var(--text-dim);border:1px solid var(--border);text-align:center;}
.score-item.ok{border-color:var(--success);color:var(--success);}
.score-item.bad{border-color:var(--danger);color:var(--danger);}
.score-icon{font-size:20px;margin-bottom:4px;}

/* COMPLETION */
.completion-card{text-align:center;padding:60px 20px;background:linear-gradient(135deg,rgba(16,185,129,.1),rgba(0,212,170,.08));border:1px solid var(--success);border-radius:20px;}
.completion-emoji{font-size:72px;margin-bottom:24px;}
.completion-card h2{font-size:36px;font-weight:700;margin-bottom:12px;}
.completion-card p{color:var(--text-dim);margin-bottom:32px;}
.completion-badges{display:flex;justify-content:center;gap:16px;flex-wrap:wrap;margin-bottom:32px;}
.badge{background:var(--surface2);border:1px solid var(--border);padding:12px 20px;border-radius:12px;font-size:13px;color:var(--accent);font-weight:600;}

/* BUTTONS */
.btn{padding:10px 20px;border-radius:10px;border:none;font-family:'Space Grotesk',sans-serif;font-size:14px;font-weight:600;cursor:pointer;transition:all .2s;display:inline-flex;align-items:center;gap:6px;}
.btn-primary{background:var(--accent);color:#fff;}
.btn-primary:hover{background:#00b894;color:#fff;transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,212,170,.3);}
.btn-ghost{background:var(--surface2);color:var(--text-dim);border:1px solid var(--border);}
.btn-ghost:hover{background:var(--border);color:var(--text);}
.btn-full{width:100%;justify-content:center;}

::-webkit-scrollbar{width:6px;height:6px;}
::-webkit-scrollbar-track{background:var(--surface);}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px;}
</style>
</head>
<body>

<!-- NAV -->
<nav>
  <a href="index.html">‚Üê Back to Exercises</a>
  <div style="display:flex;gap:10px;align-items:center;">
    <span class="nav-badge">IT426 ¬∑ AI Systems</span>
    <span class="nav-badge">King Saud University</span>
  </div>
</nav>

<!-- HERO -->
<div class="hero">
  <div class="hero-tag">Module 2 ¬∑ Problem Formulation</div>
  <h1>Vacuum World ü§ñ</h1>
  <p>Both rooms are dirty ‚Äî clean them all! Learn state representation, actions, and the transition model</p>
</div>

<!-- STEPS -->
<div class="steps-bar">
  <div class="step"><div class="step-circle active" id="sc1">1</div><div class="step-label active" id="sl1">Control Robot</div></div>
  <div class="step-line" id="line1"></div>
  <div class="step"><div class="step-circle" id="sc2">2</div><div class="step-label" id="sl2">All States</div></div>
  <div class="step-line" id="line2"></div>
  <div class="step"><div class="step-circle" id="sc3">3</div><div class="step-label" id="sl3">Transitions</div></div>
  <div class="step-line" id="line3"></div>
  <div class="step"><div class="step-circle" id="sc4">4</div><div class="step-label" id="sl4">Formulate</div></div>
</div>

<!-- ‚ïê‚ïê SECTION 1: PLAY ‚ïê‚ïê -->
<section class="section visible" id="sec1">
  <div class="section-title">Step 1: Control the Vacuum Robot ü§ñ</div>
  <div class="section-subtitle">Both rooms start dirty üóëÔ∏è ‚Äî use Left, Right, and Suck to clean them both. Watch the state representation update with every action!</div>

  <div class="card">
    <div class="vw-layout">
      <!-- Grid + Controls -->
      <div>
        <div class="vw-grid" id="vw-grid">
          <!-- Rooms generated by JS -->
        </div>

        <div style="margin-top:20px;">
          <div style="font-size:12px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.08em;font-weight:700;margin-bottom:10px;">Actions</div>
          <div class="action-grid">
            <button class="action-btn" id="btn-left" onclick="vacuum.doAction('Left')">‚Üê Left</button>
            <button class="action-btn suck" id="btn-suck" onclick="vacuum.doAction('Suck')">üåÄ Suck</button>
            <button class="action-btn" id="btn-right" onclick="vacuum.doAction('Right')">Right ‚Üí</button>
          </div>
        </div>

        <div style="margin-top:16px;" class="cost-bar">
          <div class="cost-item"><div class="cost-val" id="step-count">0</div><div class="cost-lbl">Steps (Path Cost)</div></div>
          <div style="width:1px;height:40px;background:var(--border);"></div>
          <div class="cost-item" style="flex:1;">
            <div style="font-size:12px;color:var(--text-dim);" id="last-action-label">No action yet</div>
            <div style="font-size:11px;color:var(--text-muted);">Last action</div>
          </div>
        </div>

        <div class="goal-banner" id="goal-banner">
          <h3>‚úÖ Both Rooms Clean!</h3>
          <p>The robot reached the goal state in <span id="goal-steps">0</span> steps.</p>
          <button class="btn btn-primary" onclick="goToSection(2)" style="background:var(--success);color:#fff;">Continue ‚Üí</button>
        </div>

        <div style="margin-top:12px;display:flex;gap:8px;">
          <button class="btn btn-ghost" onclick="vacuum.reset()" style="flex:1;">üîÑ Reset</button>
          <button class="btn btn-ghost" onclick="goToSection(2)" style="font-size:12px;opacity:.6;">Skip ‚Üí</button>
        </div>
      </div>

      <!-- State panel -->
      <div class="state-log">
        <div class="card-sm">
          <div class="state-label">Current State</div>
          <div class="code-block"><span class="code-comment">// (robot_location, roomA_dirty, roomB_dirty)</span>
<span id="state-display">state = ("A", True, True)</span></div>
        </div>

        <div class="card-sm">
          <div class="state-label">State as Tuple</div>
          <div class="code-block" id="state-detail" style="font-size:11px;">robot  : A
room_A : üü° Dirty
room_B : üü° Dirty</div>
        </div>

        <div class="card-sm">
          <div class="state-label">Action History</div>
          <div class="history-log" id="action-history">
            <div style="color:var(--text-muted);font-size:12px;padding:4px 8px;">No actions yet‚Ä¶</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ‚ïê‚ïê SECTION 2: ALL STATES ‚ïê‚ïê -->
<section class="section" id="sec2">
  <div class="section-title">Step 2: All 8 Possible States üóÇÔ∏è</div>
  <div class="section-subtitle">The vacuum world has exactly 8 possible states. Click any state to see its representation!</div>

  <div class="card">
    <p style="color:var(--text-dim);font-size:14px;margin-bottom:20px;">
      The robot can be in <strong>2 rooms</strong> (A or B), and each room can be <strong>dirty or clean</strong>.<br>
      Total states = 2 rooms √ó 2¬≤ dirt combinations = <strong>2 √ó 4 = 8 states</strong>
    </p>

    <div class="states-grid" id="states-grid">
      <!-- Generated by JS -->
    </div>

    <!-- Selected state info -->
    <div id="state-info-box" style="display:none;background:var(--surface2);border:1px solid var(--border);border-radius:14px;padding:20px;margin-top:16px;animation:fadeUp .3s ease;">
      <div style="font-size:14px;font-weight:700;margin-bottom:12px;">Selected State Details:</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
        <div>
          <div style="font-size:11px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.08em;font-weight:700;margin-bottom:6px;">Representation</div>
          <div class="code-block" id="selected-state-repr" style="font-size:12px;"></div>
        </div>
        <div>
          <div style="font-size:11px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.08em;font-weight:700;margin-bottom:6px;">Possible Actions</div>
          <div class="code-block" id="selected-state-actions" style="font-size:12px;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Q2: Total states question -->
  <div style="margin-top:32px;">
    <div class="question-box">
      <div class="question-text">‚ùì For a larger vacuum with <em>n</em> rooms, how many total states exist?</div>
      <div class="options" id="q2-options">
        <button class="option" onclick="selectOpt('q2',this,'wrong')">
          <span class="opt-letter">A</span>
          <div><div>n √ó 2</div><div class="opt-sub">n rooms times 2</div></div>
        </button>
        <button class="option" onclick="selectOpt('q2',this,'correct')">
          <span class="opt-letter">B</span>
          <div><div>n √ó 2‚Åø</div><div class="opt-sub">n locations √ó 2‚Åø dirt combinations</div></div>
        </button>
        <button class="option" onclick="selectOpt('q2',this,'wrong')">
          <span class="opt-letter">C</span>
          <div><div>2‚Åø</div><div class="opt-sub">Just the dirt combinations</div></div>
        </button>
        <button class="option" onclick="selectOpt('q2',this,'wrong')">
          <span class="opt-letter">D</span>
          <div><div>n¬≤</div><div class="opt-sub">n rooms squared</div></div>
        </button>
      </div>
      <div class="feedback" id="q2-feedback"></div>
    </div>

    <div class="explanation-box" id="q2-explanation">
      <h3>‚úÖ Why n √ó 2‚Åø?</h3>
      <ul>
        <li>The robot can be in any of the <strong>n rooms</strong> ‚Üí n positions</li>
        <li>Each room independently can be <strong>dirty or clean</strong> ‚Üí 2‚Åø combinations</li>
        <li>For 2 rooms: 2 √ó 2¬≤ = <strong>8 states</strong> ‚úì</li>
        <li>For 3 rooms: 3 √ó 2¬≥ = <strong>24 states</strong></li>
        <li>States grow <strong>exponentially</strong> ‚Äî this is why search is challenging!</li>
      </ul>
      <div style="margin-top:16px;">
        <button class="btn btn-primary" onclick="goToSection(3)">Continue to Transitions ‚Üí</button>
      </div>
    </div>
  </div>
</section>

<!-- ‚ïê‚ïê SECTION 3: TRANSITIONS ‚ïê‚ïê -->
<section class="section" id="sec3">
  <div class="section-title">Step 3: Transition Model üîÑ</div>
  <div class="section-subtitle">Pick a starting state, then an action, and see what state results!</div>

  <div class="card">
    <div style="display:grid;grid-template-columns:1fr auto 1fr;gap:24px;align-items:center;">

      <!-- Source State Picker -->
      <div>
        <div style="font-size:13px;font-weight:700;color:var(--text-dim);margin-bottom:12px;text-align:center;">FROM State</div>
        <div id="from-state-picker" style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
          <!-- Generated by JS -->
        </div>
      </div>

      <!-- Arrow + Action -->
      <div style="text-align:center;">
        <div style="font-size:40px;color:var(--text-muted);" id="arrow-icon">‚Üí</div>
        <div style="font-size:13px;font-weight:700;color:var(--text-dim);margin-top:8px;margin-bottom:12px;">Action</div>
        <div style="display:flex;flex-direction:column;gap:8px;">
          <button class="action-btn" id="trans-left" onclick="doTransition('Left')" disabled>‚Üê Left</button>
          <button class="action-btn suck" id="trans-suck" onclick="doTransition('Suck')" disabled>üåÄ Suck</button>
          <button class="action-btn" id="trans-right" onclick="doTransition('Right')" disabled>Right ‚Üí</button>
        </div>
      </div>

      <!-- Result State -->
      <div>
        <div style="font-size:13px;font-weight:700;color:var(--text-dim);margin-bottom:12px;text-align:center;">TO State</div>
        <div id="trans-result" style="background:var(--surface2);border:2px dashed var(--border);border-radius:12px;padding:30px;text-align:center;color:var(--text-muted);font-size:13px;min-height:160px;display:flex;align-items:center;justify-content:center;">
          Pick a state and action
        </div>
      </div>
    </div>

    <!-- Transition log -->
    <div style="margin-top:24px;background:var(--bg);border:1px solid var(--border);border-radius:12px;padding:16px;">
      <div style="font-size:12px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.08em;font-weight:700;margin-bottom:10px;">Transitions Explored</div>
      <div id="trans-log" style="font-size:12px;color:var(--text-dim);font-family:'JetBrains Mono',monospace;">
        No transitions yet ‚Äî select a FROM state and click an action.
      </div>
    </div>
  </div>

  <!-- Q3: Transition question -->
  <div style="margin-top:32px;">
    <div class="question-box">
      <div class="question-text">‚ùì If the robot is in room A and room A is dirty, what does "Suck" produce?</div>
      <div class="options" id="q3-options">
        <button class="option" onclick="selectOpt('q3',this,'wrong')">
          <span class="opt-letter">A</span>
          <div>Robot moves to room B</div>
        </button>
        <button class="option" onclick="selectOpt('q3',this,'correct')">
          <span class="opt-letter">B</span>
          <div>Room A becomes clean, robot stays in A</div>
        </button>
        <button class="option" onclick="selectOpt('q3',this,'wrong')">
          <span class="opt-letter">C</span>
          <div>Both rooms become clean</div>
        </button>
        <button class="option" onclick="selectOpt('q3',this,'wrong')">
          <span class="opt-letter">D</span>
          <div>Room A becomes dirty (Suck reverses)</div>
        </button>
      </div>
      <div class="feedback" id="q3-feedback"></div>
    </div>

    <div class="explanation-box" id="q3-explanation">
      <h3>‚úÖ Correct! The Transition Model:</h3>
      <ul>
        <li><strong>Left:</strong> Robot moves from B to A (if in B). No effect if already in A.</li>
        <li><strong>Right:</strong> Robot moves from A to B (if in A). No effect if already in B.</li>
        <li><strong>Suck:</strong> Cleans the current room ‚Äî regardless of whether it was dirty or not.</li>
        <li>Each action produces exactly one resulting state ‚Äî this is a <strong>deterministic</strong> environment.</li>
      </ul>
      <div style="margin-top:16px;">
        <button class="btn btn-primary" onclick="goToSection(4)">Continue to Formulate ‚Üí</button>
      </div>
    </div>
  </div>
</section>

<!-- ‚ïê‚ïê SECTION 4: FORMULATE ‚ïê‚ïê -->
<section class="section" id="sec4">
  <div class="section-title">Step 4: Formulate the Problem üìã</div>
  <div class="section-subtitle">Based on what you've learned, answer these five components for the Vacuum World.</div>

  <div class="form-components">

    <div class="form-comp" id="fc1">
      <div class="comp-title"><div class="comp-num">1</div> State Representation</div>
      <div class="comp-desc">What does each state in the vacuum world capture?</div>
      <div class="options" id="fc1-opts">
        <button class="option" onclick="fcSel('fc1',this,'correct')"><span class="opt-letter">A</span><div>A tuple: (robot_location, room_A_dirty, room_B_dirty)</div></button>
        <button class="option" onclick="fcSel('fc1',this,'wrong')"><span class="opt-letter">B</span><div>Only which rooms are dirty</div></button>
        <button class="option" onclick="fcSel('fc1',this,'wrong')"><span class="opt-letter">C</span><div>Only where the robot is</div></button>
      </div>
      <div class="grade-feedback" id="fc1-fb"></div>
    </div>

    <div class="form-comp" id="fc2">
      <div class="comp-title"><div class="comp-num">2</div> Initial State</div>
      <div class="comp-desc">What is a valid initial state for the vacuum world?</div>
      <div class="options" id="fc2-opts">
        <button class="option" onclick="fcSel('fc2',this,'wrong')"><span class="opt-letter">A</span><div>Always starts with robot in A and both rooms clean</div></button>
        <button class="option" onclick="fcSel('fc2',this,'correct')"><span class="opt-letter">B</span><div>Any of the 8 states can be the initial state</div></button>
        <button class="option" onclick="fcSel('fc2',this,'wrong')"><span class="opt-letter">C</span><div>Only states where at least one room is dirty</div></button>
      </div>
      <div class="grade-feedback" id="fc2-fb"></div>
    </div>

    <div class="form-comp" id="fc3">
      <div class="comp-title"><div class="comp-num">3</div> Actions</div>
      <div class="comp-desc">What are the available actions in each state?</div>
      <div class="options" id="fc3-opts">
        <button class="option" onclick="fcSel('fc3',this,'wrong')"><span class="opt-letter">A</span><div>Move Up, Down, Left, Right</div></button>
        <button class="option" onclick="fcSel('fc3',this,'correct')"><span class="opt-letter">B</span><div>Left, Right, Suck ‚Äî always 3 actions per state</div></button>
        <button class="option" onclick="fcSel('fc3',this,'wrong')"><span class="opt-letter">C</span><div>Only Suck when dirty, only Move when clean</div></button>
      </div>
      <div class="grade-feedback" id="fc3-fb"></div>
    </div>

    <div class="form-comp" id="fc4">
      <div class="comp-title"><div class="comp-num">4</div> Goal Test</div>
      <div class="comp-desc">When has the robot successfully completed its task?</div>
      <div class="options" id="fc4-opts">
        <button class="option" onclick="fcSel('fc4',this,'wrong')"><span class="opt-letter">A</span><div>When the robot returns to room A</div></button>
        <button class="option" onclick="fcSel('fc4',this,'wrong')"><span class="opt-letter">B</span><div>When at least one room is clean</div></button>
        <button class="option" onclick="fcSel('fc4',this,'correct')"><span class="opt-letter">C</span><div>When both rooms are clean (room_A_dirty = False AND room_B_dirty = False)</div></button>
      </div>
      <div class="grade-feedback" id="fc4-fb"></div>
    </div>

    <div class="form-comp" id="fc5">
      <div class="comp-title"><div class="comp-num">5</div> Path Cost</div>
      <div class="comp-desc">How is the cost of a solution measured?</div>
      <div class="options" id="fc5-opts">
        <button class="option" onclick="fcSel('fc5',this,'correct')"><span class="opt-letter">A</span><div>Each action costs 1 ‚Äî optimal solution minimizes total number of actions</div></button>
        <button class="option" onclick="fcSel('fc5',this,'wrong')"><span class="opt-letter">B</span><div>Suck costs 2, Move costs 1</div></button>
        <button class="option" onclick="fcSel('fc5',this,'wrong')"><span class="opt-letter">C</span><div>Cost = number of dirty rooms at the end</div></button>
      </div>
      <div class="grade-feedback" id="fc5-fb"></div>
    </div>

  </div>

  <div style="margin-top:28px;">
    <button class="btn btn-primary btn-full" onclick="gradeVacuum()" style="font-size:16px;padding:14px;">‚úÖ Submit Answers</button>
  </div>

  <div id="score-section" style="display:none;margin-top:32px;animation:fadeUp .5s ease;">
    <div class="score-card">
      <div class="score-big" id="score-pct">‚Äî</div>
      <div class="score-label" id="score-msg">‚Äî</div>
      <div class="score-breakdown" id="score-breakdown"></div>
      <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap;">
        <button class="btn btn-ghost" id="btn-retry" onclick="retryVacuum()" style="display:none;">‚Ü∫ Try Again</button>
        <button class="btn btn-primary" id="btn-complete" onclick="goToSection(5)" style="display:none;">Complete Module üéâ</button>
      </div>
    </div>
  </div>
</section>

<!-- ‚ïê‚ïê SECTION 5: COMPLETE ‚ïê‚ïê -->
<section class="section" id="sec5">
  <div class="completion-card">
    <div class="completion-emoji">üéì</div>
    <h2>Module Complete!</h2>
    <p>You've mastered the Vacuum World problem formulation</p>
    <div class="completion-badges">
      <div class="badge">‚úì Controlled Robot</div>
      <div class="badge">‚úì 8 States Understood</div>
      <div class="badge">‚úì Transitions Explored</div>
      <div class="badge">‚úì Problem Formulated</div>
    </div>
    <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap;">
      <button class="btn btn-ghost" onclick="location.reload()">‚Ü∫ Start Over</button>
      <a href="index.html" class="btn btn-primary" style="text-decoration:none;">‚Üê Back to Exercises</a>
    </div>
  </div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê JAVASCRIPT ‚ïê‚ïê‚ïê‚ïê -->
<script>
// ‚îÄ‚îÄ ALL 8 STATES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Each state: [robot ('A'|'B'), roomA_dirty (bool), roomB_dirty (bool)]
const ALL_STATES = [
  ['A', true,  true ],  // 0
  ['A', true,  false],  // 1
  ['A', false, true ],  // 2
  ['A', false, false],  // 3 ‚Äî GOAL
  ['B', true,  true ],  // 4
  ['B', true,  false],  // 5
  ['B', false, true ],  // 6
  ['B', false, false],  // 7 ‚Äî GOAL
];

const GOAL_INDICES = [3, 7]; // states where both rooms clean

function isGoalState(s) { return !s[1] && !s[2]; }

// ‚îÄ‚îÄ TRANSITION FUNCTION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function transition(state, action) {
  let [robot, dirtyA, dirtyB] = state;
  if (action === 'Left')  return ['A', dirtyA, dirtyB];
  if (action === 'Right') return ['B', dirtyA, dirtyB];
  if (action === 'Suck') {
    if (robot === 'A') return ['A', false, dirtyB];
    if (robot === 'B') return ['B', dirtyA, false];
  }
  return state;
}

function statesEqual(a, b) { return a[0]===b[0] && a[1]===b[1] && a[2]===b[2]; }

function stateIndex(s) {
  return ALL_STATES.findIndex(st => statesEqual(st, s));
}

function stateLabel(s) {
  const r = s[0];
  const a = s[1] ? 'üü°' : '‚úÖ';
  const b = s[2] ? 'üü°' : '‚úÖ';
  return `(${r}, A:${a}, B:${b})`;
}

function stateTuple(s) {
  return `("${s[0]}", ${s[1]}, ${s[2]})`;
}

// ‚îÄ‚îÄ VACUUM WORLD INTERACTIVE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const vacuum = (() => {
  let state = ['A', true, true];
  let steps = 0;
  let history = [];

  function reset() {
    state = ['A', true, true];
    steps = 0;
    history = [];
    render();
    document.getElementById('goal-banner').classList.remove('show');
  }

  function doAction(action) {
    const newState = transition(state, action);
    const changed = !statesEqual(state, newState);
    const prevState = [...state];
    state = newState;
    steps++;

    history.push({ num: steps, action, from: prevState, to: [...state] });
    render();
    animateRoom(action, prevState, state);

    document.getElementById('last-action-label').textContent = action;

    if (isGoalState(state)) {
      setTimeout(() => {
        const banner = document.getElementById('goal-banner');
        banner.classList.add('show');
        document.getElementById('goal-steps').textContent = steps;
      }, 400);
    }
  }

  function animateRoom(action, from, to) {
    const roomA = document.querySelector('[data-room="A"]');
    const roomB = document.querySelector('[data-room="B"]');
    if (action === 'Suck') {
      const cleanedRoom = from[0] === 'A' ? roomA : roomB;
      if (cleanedRoom) {
        cleanedRoom.classList.add('flash-clean');
        setTimeout(() => cleanedRoom.classList.remove('flash-clean'), 500);
      }
    } else {
      const movedTo = to[0] === 'A' ? roomA : roomB;
      if (movedTo) {
        movedTo.classList.add('flash-move');
        setTimeout(() => movedTo.classList.remove('flash-move'), 300);
      }
    }
  }

  function render() {
    const grid = document.getElementById('vw-grid');
    grid.innerHTML = '';

    ['A','B'].forEach(room => {
      const hasRobot = state[0] === room;
      const isDirty  = room === 'A' ? state[1] : state[2];
      const div = document.createElement('div');
      div.dataset.room = room;
      div.className = 'vw-room' +
        (hasRobot && isDirty ? ' has-both' : hasRobot ? ' has-robot' : isDirty ? ' has-dirt' : '');

      div.innerHTML = `
        <div class="room-label">Room ${room}</div>
        <div class="room-contents">
          ${hasRobot ? 'ü§ñ' : ''}
          ${isDirty  ? 'üóëÔ∏è' : '‚ú®'}
        </div>
        <div class="room-status ${isDirty ? 'status-dirty' : 'status-clean'}">
          ${isDirty ? 'Dirty' : 'Clean'}
        </div>
      `;
      grid.appendChild(div);
    });

    // Update action buttons
    const leftBtn  = document.getElementById('btn-left');
    const rightBtn = document.getElementById('btn-right');
    leftBtn.disabled  = (state[0] === 'A');
    rightBtn.disabled = (state[0] === 'B');

    // Update state display
    document.getElementById('state-display').textContent = `state = ${stateTuple(state)}`;
    document.getElementById('state-detail').textContent =
      `robot  : ${state[0]}\nroom_A : ${state[1] ? 'üü° Dirty' : '‚úÖ Clean'}\nroom_B : ${state[2] ? 'üü° Dirty' : '‚úÖ Clean'}`;
    document.getElementById('step-count').textContent = steps;

    // History
    const log = document.getElementById('action-history');
    if (history.length === 0) {
      log.innerHTML = '<div style="color:var(--text-muted);font-size:12px;padding:4px 8px;">No actions yet‚Ä¶</div>';
    } else {
      const last = history.slice(-6).reverse();
      log.innerHTML = last.map(h =>
        `<div class="history-entry">
          <span class="h-num">${h.num}</span>
          <span class="h-action">${h.action}</span>
          <span class="h-state">${stateTuple(h.from)} ‚Üí ${stateTuple(h.to)}</span>
        </div>`
      ).join('');
    }
  }

  return { reset, doAction, render };
})();

// ‚îÄ‚îÄ ALL-STATES GRID ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function buildStatesGrid() {
  const grid = document.getElementById('states-grid');
  ALL_STATES.forEach((s, idx) => {
    const div = document.createElement('div');
    div.className = 'mini-state' + (isGoalState(s) ? ' goal-state' : '');
    div.onclick = () => showStateInfo(idx);

    div.innerHTML = `
      <div class="mini-grid">
        <div class="mini-cell ${s[0]==='A' ? 'robot' : (s[1] ? 'dirt' : 'clean')}">${s[0]==='A' ? 'ü§ñ' : (s[1] ? 'üóëÔ∏è' : '')}</div>
        <div class="mini-cell ${s[0]==='B' ? 'robot' : (s[2] ? 'dirt' : 'clean')}">${s[0]==='B' ? 'ü§ñ' : (s[2] ? 'üóëÔ∏è' : '')}</div>
      </div>
      <div class="mini-state-id">S${idx} ${isGoalState(s) ? '‚úì' : ''}</div>
      <div style="font-size:10px;color:var(--text-muted);">Robot:${s[0]}</div>
    `;
    grid.appendChild(div);
  });
}

function showStateInfo(idx) {
  const s = ALL_STATES[idx];
  const box = document.getElementById('state-info-box');
  box.style.display = 'block';

  // Highlight selected
  document.querySelectorAll('.mini-state').forEach((el,i) => {
    el.classList.toggle('highlighted', i === idx);
  });

  document.getElementById('selected-state-repr').textContent =
    `state = ${stateTuple(s)}\n\nrobot  : ${s[0]}\nroom_A : ${s[1] ? 'Dirty' : 'Clean'}\nroom_B : ${s[2] ? 'Dirty' : 'Clean'}\ngoal?  : ${isGoalState(s) ? 'YES ‚úì' : 'No'}`;

  const actions = ['Left','Right','Suck'];
  const actionText = actions.map(a => {
    const result = transition(s, a);
    const changed = !statesEqual(s, result);
    return `${a.padEnd(6)} ‚Üí S${stateIndex(result)}${changed ? '' : ' (no change)'}`;
  }).join('\n');
  document.getElementById('selected-state-actions').textContent = actionText;
}

// ‚îÄ‚îÄ TRANSITION EXPLORER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let selectedFromState = null;
let transLogEntries = [];

function buildFromPicker() {
  const picker = document.getElementById('from-state-picker');
  ALL_STATES.forEach((s, idx) => {
    const btn = document.createElement('button');
    btn.className = 'mini-state';
    btn.style.cssText = 'cursor:pointer;';
    btn.dataset.idx = idx;
    btn.innerHTML = `
      <div class="mini-grid">
        <div class="mini-cell ${s[0]==='A' ? 'robot' : (s[1] ? 'dirt' : 'clean')}">${s[0]==='A' ? 'ü§ñ' : (s[1] ? 'üóëÔ∏è' : '')}</div>
        <div class="mini-cell ${s[0]==='B' ? 'robot' : (s[2] ? 'dirt' : 'clean')}">${s[0]==='B' ? 'ü§ñ' : (s[2] ? 'üóëÔ∏è' : '')}</div>
      </div>
      <div class="mini-state-id">S${idx}</div>
    `;
    btn.onclick = () => selectFromState(idx);
    picker.appendChild(btn);
  });
}

function selectFromState(idx) {
  selectedFromState = idx;
  document.querySelectorAll('#from-state-picker .mini-state').forEach((el,i) => {
    el.classList.toggle('highlighted', i === idx);
  });
  // Enable action buttons
  ['trans-left','trans-suck','trans-right'].forEach(id => {
    document.getElementById(id).disabled = false;
  });
  document.getElementById('trans-result').innerHTML =
    `<div style="color:var(--text-dim);font-size:13px;">S${idx} selected ‚Üí choose an action!</div>`;
  document.getElementById('arrow-icon').textContent = '‚üπ';
}

function doTransition(action) {
  if (selectedFromState === null) return;
  const from = ALL_STATES[selectedFromState];
  const to   = transition(from, action);
  const toIdx = stateIndex(to);
  const changed = !statesEqual(from, to);

  // Show result
  const toState = ALL_STATES[toIdx];
  document.getElementById('trans-result').innerHTML = `
    <div>
      <div class="mini-grid" style="margin:0 auto 8px;">
        <div class="mini-cell ${toState[0]==='A'?'robot':(toState[1]?'dirt':'clean')}">${toState[0]==='A'?'ü§ñ':(toState[1]?'üóëÔ∏è':'')}</div>
        <div class="mini-cell ${toState[0]==='B'?'robot':(toState[2]?'dirt':'clean')}">${toState[0]==='B'?'ü§ñ':(toState[2]?'üóëÔ∏è':'')}</div>
      </div>
      <div style="font-size:13px;font-weight:700;color:var(--accent);">S${toIdx}</div>
      <div style="font-size:11px;color:var(--text-muted);margin-top:4px;">${changed ? '‚úÖ State changed' : '‚ö†Ô∏è No change'}</div>
      <div style="font-size:11px;color:var(--text-dim);margin-top:6px;">Robot:${toState[0]} | A:${toState[1]?'Dirty':'Clean'} | B:${toState[2]?'Dirty':'Clean'}</div>
      ${isGoalState(toState) ? '<div style="color:var(--success);font-size:12px;font-weight:700;margin-top:6px;">üéØ GOAL STATE!</div>' : ''}
    </div>
  `;

  // Add to log
  transLogEntries.push(`RESULT(S${selectedFromState}, ${action.padEnd(6)}) = S${toIdx}${isGoalState(toState)?' ‚Üê GOAL':''}`);
  document.getElementById('trans-log').innerHTML =
    transLogEntries.slice(-6).map(e =>
      `<div style="padding:3px 0;border-bottom:1px solid var(--border);">${e}</div>`
    ).join('');
}

// ‚îÄ‚îÄ SECTION NAV ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function goToSection(n) {
  for (let i = 1; i <= 5; i++) document.getElementById(`sec${i}`)?.classList.remove('visible');
  document.getElementById(`sec${n}`)?.classList.add('visible');
  window.scrollTo({top:0,behavior:'smooth'});
  updateSteps(n);
}

function updateSteps(active) {
  for (let i = 1; i <= 4; i++) {
    const c = document.getElementById(`sc${i}`);
    const l = document.getElementById(`sl${i}`);
    const ln = document.getElementById(`line${i}`);
    c.className = 'step-circle'; l.className = 'step-label';
    if (ln) ln.className = 'step-line';
    if (i < active)       { c.classList.add('done'); c.textContent='‚úì'; l.classList.add('done'); if(ln) ln.classList.add('done'); }
    else if (i === active) { c.classList.add('active'); c.textContent=i; l.classList.add('active'); }
    else                   { c.textContent = i; }
  }
}

// ‚îÄ‚îÄ Q&A ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function selectOpt(qid, btn, result) {
  document.getElementById(`${qid}-options`).querySelectorAll('.option').forEach(o => {
    o.classList.remove('selected','correct-ans','wrong-ans');
  });
  const fb = document.getElementById(`${qid}-feedback`);
  if (result === 'correct') {
    btn.classList.add('correct-ans');
    fb.className = 'feedback show correct';
    fb.innerHTML = '<div class="fb-title">‚úÖ Correct!</div>Well done ‚Äî you understand the state space structure.';
    document.getElementById(`${qid}-explanation`)?.classList.add('show');
    document.getElementById(`${qid}-options`).querySelectorAll('.option').forEach(o => o.disabled = true);
  } else {
    btn.classList.add('wrong-ans');
    fb.className = 'feedback show wrong';
    fb.innerHTML = '<div class="fb-title">‚ùå Not quite.</div>Think about what information fully describes a moment in the vacuum world.';
  }
}

// ‚îÄ‚îÄ FORMULATION GRADER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const fcAnswers = {fc1:null,fc2:null,fc3:null,fc4:null,fc5:null};
const fcFeedback = {
  fc1: {correct:"‚úÖ A tuple (robot, dirtyA, dirtyB) captures all needed info.", wrong:"‚ùå The state must include BOTH the robot location AND the dirt status of all rooms."},
  fc2: {correct:"‚úÖ Any of the 8 states is valid ‚Äî the agent can start anywhere.", wrong:"‚ùå Any valid configuration can be the initial state, not just one specific one."},
  fc3: {correct:"‚úÖ Left, Right, Suck ‚Äî always 3 actions regardless of the current state.", wrong:"‚ùå The agent always has 3 actions available: Left, Right, and Suck."},
  fc4: {correct:"‚úÖ Goal = both rooms clean. The robot's location doesn't matter.", wrong:"‚ùå The goal is achieved when ALL rooms are clean (both room_A and room_B dirty = False)."},
  fc5: {correct:"‚úÖ Each of the 3 actions costs 1 ‚Äî optimal means minimum actions.", wrong:"‚ùå Standard path cost = 1 per action, regardless of action type."}
};

function fcSel(fc, btn, result) {
  document.getElementById(`${fc}-opts`).querySelectorAll('.option').forEach(o => o.classList.remove('selected','correct-ans','wrong-ans'));
  btn.classList.add('selected');
  fcAnswers[fc] = result;
}

function gradeVacuum() {
  let correct = 0;
  const names = ['State Representation','Initial State','Actions','Goal Test','Path Cost'];
  const breakdown = document.getElementById('score-breakdown');
  breakdown.innerHTML = '';

  ['fc1','fc2','fc3','fc4','fc5'].forEach((fc,i) => {
    const ans = fcAnswers[fc];
    const comp = document.getElementById(fc);
    const fb   = document.getElementById(`${fc}-fb`);
    const ok   = ans === 'correct';
    if (ok) correct++;
    comp.classList.add(ok ? 'graded-correct' : 'graded-wrong');
    comp.classList.remove(ok ? 'graded-wrong' : 'graded-correct');
    fb.className = `grade-feedback show ${ok?'ok':'bad'}`;
    fb.textContent = ans === null ? '‚ö†Ô∏è No answer selected.' : fcFeedback[fc][ok?'correct':'wrong'];
    document.getElementById(`${fc}-opts`).querySelectorAll('.option.selected').forEach(o => {
      o.classList.remove('selected'); o.classList.add(ok?'correct-ans':'wrong-ans');
    });
    breakdown.innerHTML += `<div class="score-item ${ok?'ok':'bad'}"><div class="score-icon">${ok?'‚úÖ':'‚ùå'}</div><div>${names[i]}</div></div>`;
  });

  const pct = Math.round(correct/5*100);
  document.getElementById('score-pct').textContent = `${pct}%`;
  const msgs = {100:'üèÜ Perfect!',80:'üéâ Excellent!',60:'üí™ Good effort ‚Äî review and retry.',0:'üîÑ Keep trying!'};
  const k = pct===100?100:pct>=80?80:pct>=60?60:0;
  document.getElementById('score-msg').textContent = msgs[k];
  document.getElementById('score-section').style.display = 'block';
  document.getElementById('score-section').scrollIntoView({behavior:'smooth'});
  document.getElementById(pct>=80?'btn-complete':'btn-retry').style.display = 'inline-flex';
}

function retryVacuum() {
  Object.keys(fcAnswers).forEach(k => fcAnswers[k]=null);
  ['fc1','fc2','fc3','fc4','fc5'].forEach(fc => {
    document.getElementById(fc).classList.remove('graded-correct','graded-wrong');
    document.getElementById(`${fc}-fb`).className = 'grade-feedback';
    document.getElementById(`${fc}-opts`).querySelectorAll('.option').forEach(o => o.classList.remove('selected','correct-ans','wrong-ans'));
  });
  document.getElementById('score-section').style.display='none';
  document.getElementById('btn-retry').style.display='none';
  document.getElementById('btn-complete').style.display='none';
  window.scrollTo({top:0,behavior:'smooth'});
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
vacuum.reset();
buildStatesGrid();
buildFromPicker();
</script>
</body>
</html>